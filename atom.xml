<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Bill Zh]]></title>
  <link href="http://geekontheway.github.com/atom.xml" rel="self"/>
  <link href="http://geekontheway.github.com/"/>
  <updated>2012-02-05T23:17:49+08:00</updated>
  <id>http://geekontheway.github.com/</id>
  <author>
    <name><![CDATA[Bill Zh]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails-Dependencies]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/24/rails-dependencies/"/>
    <updated>2011-12-24T06:10:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/24/rails-dependencies</id>
    <content type="html"><![CDATA[<blockquote><p>Mac</p></blockquote>

<p>Xcode,<code>rvm 安装1.9以上版本的ruby需要设置编译器为gcc</code></p>

<blockquote><p>Ubuntu 10.04 LTS</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-get install wget vim build-essential openssl libssl-dev libreadline6 libreadline6-dev curl git-core zlib1g zlib1g-dev libssl-dev libyaml-dev libxml2-dev libxslt-dev autoconf automake libtool imagemagick libpcre3-dev libmysqld-dev</span></code></pre></td></tr></table></div></figure>


<blockquote><p>CentOS 5</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum groupinstall "Development Tools"
</span><span class='line'>yum install zlib-devel wget openssl-devel pcre pcre-devel make gcc gcc-c++ curl-devel mysql-devel
</span><span class='line'>
</span><span class='line'># gem install mysql --no-rdoc --no-ri -- --with-mysql-dir=/usr/bin --with-mysql-lib=/usr/lib/mysql --with-mysql-include=/usr/include/mysql</span></code></pre></td></tr></table></div></figure>


<p>更多阅读</p>

<p><a href="http://packages.ubunut.com/" title="Ubuntu Packages Search">Ubuntu Packages Search</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Install-Mysql-Server-In-Unix-Like-Operating-System]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/24/install-mysql-server-in-unix-like-operating-system/"/>
    <updated>2011-12-24T06:08:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/24/install-mysql-server-in-unix-like-operating-system</id>
    <content type="html"><![CDATA[<blockquote><p>CentOS 5</p></blockquote>

<ul>
<li>Installing MySQL</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install mysql-server
</span><span class='line'>/sbin/chkconfig --levels 235 mysqld on</span></code></pre></td></tr></table></div></figure>


<p>The MySQL server package will be installed on your server, <strong>along with dependencies and client libraries.</strong> Start MySQL by running the following command:</p>

<p><code>service mysqld start</code></p>

<ul>
<li>Configuring MySQL</li>
</ul>


<p>After installing MySQL, it&#8217;s recommended that you run <strong>mysql_secure_installation</strong>, a program that helps secure MySQL. While running mysql_secure_installation, <strong>you will be presented with the opportunity to change the MySQL root password, remove anonymous user accounts, disable root logins outside of localhost, and remove test databases.</strong> It is recommended that you answer yes to these options. If you are prompted to reload the privilege tables, select yes.</p>

<p>By default, MySQL makes some assumptions about your server environment with respect to memory. To configure MySQL more conservatively, you&#8217;ll need to edit some settings in its configuration file. Your file should resemble the following:</p>

<p><code>File:/etc/my.cnf</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[mysqld]
</span><span class='line'>datadir=/var/lib/mysql
</span><span class='line'>socket=/var/lib/mysql/mysql.sock
</span><span class='line'>user=mysql
</span><span class='line'># Default to using old password format for compatibility with mysql 3.x
</span><span class='line'># clients (those using the mysqlclient10 compatibility package).
</span><span class='line'>old_passwords=1
</span><span class='line'>
</span><span class='line'># Disabling symbolic-links is recommended to prevent assorted security risks;
</span><span class='line'># to do so, uncomment this line:
</span><span class='line'># symbolic-links=0
</span><span class='line'>
</span><span class='line'>key_buffer = 16K
</span><span class='line'>max_allowed_packet = 1M
</span><span class='line'>thread_stack = 64K
</span><span class='line'>table_cache = 4
</span><span class='line'>sort_buffer = 64K
</span><span class='line'>net_buffer_length = 2K
</span><span class='line'>bind-address = 127.0.0.1
</span><span class='line'>
</span><span class='line'>[mysqld_safe]
</span><span class='line'>log-error=/var/log/mysqld.log
</span><span class='line'>pid-file=/var/run/mysqld/mysqld.pid
</span><span class='line'>These settings are only suggested values for a low memory environment; please feel free to tune them to appropriate values for your server. Consult the "More Information" section at the end of this tutorial for additional resources for this topic.</span></code></pre></td></tr></table></div></figure>


<p>If you made any changes to MySQL&#8217;s configuration, issue the following command to restart it:</p>

<p><code>service mysqld restart</code></p>

<p>MySQL will bind to localhost (127.0.0.1) by default. Please reference our secure MySQL remote access guide for information on connecting to your databases with local clients.</p>

<p>Allowing unrestricted access to MySQL on a public IP not advised, but you may change the address it listens on by modifying the bind-address parameter. If you decide to bind MySQL to your public IP, <strong>you should implement firewall rules that only allow connections from specific IP addresses.
</strong></p>

<ul>
<li>Using MySQL</li>
</ul>


<p>To generate a list of commands for the MySQL prompt type \h:</p>

<p><code>Note that all text commands must be first on line and end with ';'</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>?         (\?) Synonym for `help'.
</span><span class='line'>clear     (\c) Clear command.
</span><span class='line'>connect   (\r) Reconnect to the server. Optional arguments are db and host.
</span><span class='line'>delimiter (\d) Set statement delimiter. NOTE: Takes the rest of the line as new delimiter.
</span><span class='line'>edit      (\e) Edit command with $EDITOR.
</span><span class='line'>ego       (\G) Send command to mysql server, display result vertically.
</span><span class='line'>exit      (\q) Exit mysql. Same as quit.
</span><span class='line'>go        (\g) Send command to mysql server.
</span><span class='line'>help      (\h) Display this help.
</span><span class='line'>nopager   (\n) Disable pager, print to stdout.
</span><span class='line'>notee     (\t) Don't write into outfile.
</span><span class='line'>pager     (\P) Set PAGER [to_pager]. Print the query results via PAGER.
</span><span class='line'>print     (\p) Print current command.
</span><span class='line'>prompt    (\R) Change your mysql prompt.
</span><span class='line'>quit      (\q) Quit mysql.
</span><span class='line'>rehash    (\#) Rebuild completion hash.
</span><span class='line'>source    (\.) Execute an SQL script file. Takes a file name as an argument.
</span><span class='line'>status    (\s) Get status information from the server.
</span><span class='line'>system    (\!) Execute a system shell command.
</span><span class='line'>tee       (\T) Set outfile [to_outfile]. Append everything into given outfile.
</span><span class='line'>use       (\u) Use another database. Takes database name as argument.
</span><span class='line'>charset   (\C) Switch to another charset. Might be needed for processing binlog with multi-byte charsets.
</span><span class='line'>warnings  (\W) Show warnings after every statement.
</span><span class='line'>nowarning (\w) Don't show warnings after every statement.</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Resetting the MySQL Root Password
If you&#8217;ve forgotten your root MySQL password, you may recover it by issuing the following commands:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/etc/init.d/mysqld stop
</span><span class='line'>mysqld_safe --skip-grant-tables &
</span><span class='line'>mysql -u root</span></code></pre></td></tr></table></div></figure>


<p>The following part of the password reset will now be done within the MySQL client program:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>USE mysql;
</span><span class='line'>UPDATE user SET PASSWORD=PASSWORD("CHANGEME") WHERE USER='root';
</span><span class='line'>FLUSH PRIVILEGES;
</span><span class='line'>exit</span></code></pre></td></tr></table></div></figure>


<p>Last, restart MySQL by issuing:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service mysqld restart</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Ubuntu 10.04 LTS (Lucid)</p></blockquote>

<ul>
<li>Installing MySQL</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-get install mysql-server
</span><span class='line'>update-rc.d mysql defaults #Or,sysv-rc-conf</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Configuring MySQL</li>
</ul>


<p><code>/etc/mysql/my.cnf</code></p>

<p>If you made any changes to MySQL&#8217;s configuration, restart it by issuing the following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/etc/init.d/mysqld restart</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Resetting the MySQL Root Password</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dpkg-reconfigure mysql-server-5.1</span></code></pre></td></tr></table></div></figure>


<blockquote><p>OS X</p></blockquote>

<p>Hombrew方式</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install mysql
</span><span class='line'>mysql_install_db
</span><span class='line'>mysql.server start</span></code></pre></td></tr></table></div></figure>


<p>二进制安装包方式</p>

<p>更多阅读</p>

<p><a href="http://www.2cto.com/database/201006/50201.html" title="更改MySQL数据库root密码的具体方法">更改MySQL数据库root密码的具体方法</a></p>

<p><a href="http://kenwublog.com/mac-os-launchd-tuning" title="Mac OS启动服务优化高级篇（launchd tuning）">Mac OS启动服务优化高级篇（launchd tuning）</a></p>

<p><a href="http://lingon.macgood.com/" title="Lingon Launchd 后台服务管理器 For Mac">Lingon Launchd 后台服务管理器 For Mac</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby语言入门by园田裕贵]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/10/learning-ruby/"/>
    <updated>2011-12-10T11:39:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/10/learning-ruby</id>
    <content type="html"><![CDATA[<p>最近在读这本书,   <a href="http://yugui.jp/files/learning-ruby-examples.20080616-143903.zip">源码在此</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>001: 他言語プログラマのためのRuby入門書『初めてのRuby』のサポートページです.</span></code></pre></td></tr></table></div></figure>


<p>有两个想法：</p>

<blockquote><p>1.有时间了学学日语</p>

<p>2.如何替换掉文本文件中每行首/行尾的行号,空格&#8230;eg.?分别使用awk+sed,vim,textmate,Sh拿出解决方案.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linode上相关安装和设置]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/09/linode-assets/"/>
    <updated>2011-12-09T16:34:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/09/linode-assets</id>
    <content type="html"><![CDATA[<blockquote><p>Deploying Rails to Linode</p></blockquote>

<div><script src='https://gist.github.com/1441585.js?file='></script>
<noscript><pre><code>Deploying Rails to Linode
==================
Installing Ruby Enterprise Edition, Apache, MySQL, and Passenger for deploying Rails 3.0 applications.

Get a Linode, and set it up with Ubuntu 10.04 LTS so that you have till April 2013 to get updates. Once the Linode is formatted, boot it and continue on.

Set up an 'A' record in your DNS, pointing to the IP of your Linode. I'm using `demo.napcs.com` here.

Initial setup
-------
Log in with `ssh root@your_ip`

Add a user

    adduser deploy

Add the user to the SUDOERS list with `visudo`

    # User privilege specification
    root    ALL=(ALL) ALL
    deploy   ALL=(ALL) ALL

    
Change the default SSH port and disallow root acces. `vim /etc/ssh/sshd_config`

    # What ports, IPs and protocols we listen for
    Port 16888
    
    ...
    PermitRootLogin no

Logout and reboot your linode via the console. Don't attempt to restart SSHD while connected. :)

Test the new settings - Log back in with `ssh deploy@your_ip -p 16888` and log out again

Create your authorized keys file

    mkdir ~/.ssh
    touch ~/.ssh/authorized_keys
    chmod 600 ~/.ssh/authorized_keys
   
Logout and upload your public key

    cat ~/.ssh/id_rsa.pub | ssh deploy@your_ip -p 16888 'cat &gt;&gt; .ssh/authorized_keys'

That looks a little complex, but we're just printing out the SSH key,
piping the output to SSH and directing it into the `authorized_keys` on the remote server. 
You could do this many ways, but this is something you could turn into a script and use this
  to add multiple keys.

Log back in and you're set with keys.

Installing Ruby
-----------

We'll use Ruby Enterprise Edition.

    sudo apt-get install build-essential patch zlib1g-dev libssl-dev libreadline5-dev
    
    mkdir src
    cd src
    wget http://rubyenterpriseedition.googlecode.com/files/ruby-enterprise-1.8.7-2011.03.tar.gz
    tar -xzvf ruby-enterprise-1.8.7-2011.03.tar.gz
    cd ruby-enterprise-1.8.7-2011.03
    sudo ./installer
    
Instructions will guide us through the install process.

Now make a symlink to REE and symlinks to the individual
components so it's not so long to type commands to do installs:

    sudo ln -fs /opt/ruby-enterprise-1.8.7-2011.03/ /opt/ruby

    sudo ln -fs /opt/ruby/bin/ruby /usr/local/bin/ruby
    sudo ln -fs /opt/ruby/bin/rake /usr/local/bin/rake
    sudo ln -fs /opt/ruby/bin/irb /usr/local/bin/irb
    sudo ln -fs /opt/ruby/bin/gem /usr/local/bin/gem
    sudo ln -fs /opt/ruby/bin/bundle /usr/local/bin/bundle
    
This also puts them on our path, and in our sudo path.

Installing MySQL for Rails
---------
We install MySQL with the package manager:

    sudo apt-get install mysql-server libmysqlclient-dev
    gem install mysql

Now log into mysql with  `mysql -u root -p` and create a user 

    create user 'rails'@'localhost' identified by 'rails';
    create databse projects_production;
    grant all on projects_production.* to 'rails'@'localhost';
   
These permissions are not the greatest. They could be hardened. 
But you have to make sure you don't tighten them too much to the point where
you can't run migrations. Read a good MySQL book.
    
Installing Git and Apache
------
    sudo apt-get install apache2 git-core

Now disable the default site.

    sudo a2dissite default
    sudo /etc/init.d/apache2 restart

Configuring Apache and Passenger
------
    sudo gem install passenger
    sudo apt-get install libcurl4-openssl-dev apache2-prefork-dev  libapr1-dev  libaprutil1-dev
    
    sudo /opt/ruby/bin/passenger-install-apache2-module 
    
Follow the instructions.

Modify `/etc/apache2.conf` and add this:

    LoadModule passenger_module /opt/ruby-enterprise-1.8.7-2011.03/lib/ruby/gems/1.8/gems/passenger-3.0.7/ext/apache2/mod_passenger.so
    PassengerRoot /opt/ruby-enterprise-1.8.7-2011.03/lib/ruby/gems/1.8/gems/passenger-3.0.7
    PassengerRuby /opt/ruby-enterprise-1.8.7-2011.03/bin/ruby

Create a new vhost

    sudo vim /etc/apache2/sites-available/demo.napcs.com
    
Put this code in the file:

    &lt;VirtualHost *:80&gt;
       ServerName demo.napcs.com
       DocumentRoot /var/www/demo.napcs.com/current/public  
       &lt;Directory /var/www/demo.napcs.com/current/public&gt;
         AllowOverride all          
         Options -MultiViews       
       &lt;/Directory&gt;
    &lt;/VirtualHost&gt;

Then enable the site

    sudo a2ensite demo.napcs.com
    sudo /etc/init.d/apache2 restart
  
And give the `deploy` user permissions to the `/var/www` root folder:

    sudo chown -R deploy:deploy /var/www 

Again, not the best approach, but an acceptable one.

We're done with server setup!


Preparing Your Rails app
---------

Create the Rails 3 application. We'll do a simple one with a single table.

    rails new demo
    cd demo
    rails g scaffold projects name:string description:text
    rake db:migrate
    rm public/index.html
    
Add a root route to `config/routes.rb`

    root :to =&gt; &quot;projects#index&quot;

Add the `mysql2` gem to your Gemfile and get the sqlite3 one only in dev mode. Specify the version numbers for the gems or you'll get burned!'

    group :development do                                                                                                                                                                                
      gem 'sqlite3', '1.3.3'
    end
 
    group :production do
      gem 'mysql2', '0.2.7'
    end
 
Then 

    bundle
    
Let's deploy!

Capistrano setup
-----------

Generate the capistrano config file:

    capify .
   
Modify the `config/deploy.rb` file with our settings for our server.

    require 'bundler/capistrano'
    
    set :application, &quot;demo.napcs.com&quot;

    # Deploy from your local Git repo by cloning and uploading a tarball
    set :scm, :git
    set :repository,  &quot;.&quot;
    set :deploy_via, :copy
    
    set :user, :deploy
    set :deploy_to, &quot;/var/www/#{application}&quot;
    set :use_sudo, false

    role :web, &quot;demo.napcs.com&quot;                          # Your HTTP server, Apache/etc
    role :app, &quot;demo.napcs.com&quot;                          # This may be the same as your `Web` server
    role :db,  &quot;demo.napcs.com&quot;, :primary =&gt; true # This is where Rails migrations will run

    namespace :deploy do
      task :start do ; end
      task :stop do ; end
      task :restart, :roles =&gt; :app, :except =&gt; { :no_release =&gt; true } do
       run &quot;#{try_sudo} touch #{File.join(current_path,'tmp','restart.txt')}&quot;
      end
    end

Pay attention to this part:

    set :scm, :git
    set :repository,  &quot;.&quot;
    set :deploy_via, :copy

This lets you from your local Git repo by cloning and uploading a tarball. This means you can
push code from your computer to your server, rather than having to pull code from your remote
Git repository to your server. Or if Github is down.


Now specify your production database info in `database.yml`:

    production:
      adapter: mysql2
      host: localhost
      database: projects_production
      username: rails
      password: rails

Here, we're putting our production db password in our `database.yml` file.
You probably want to keep this file out of your repository, and instead
write a custom Capistrano task to build the `database.yml` file during 
deployment. That's something you can Google on your own.

Now make a Git repo
    
    git init
    git add .
    git commit -a -m &quot;Initial import&quot;

Finally, set up the app on the server:

    cap deploy:setup
    
Deploy the app

    cap deploy:cold

And we're done! At this point, make changes to your code, commit them, redeploy with

    cap deploy
    
Bonus: Stream your logfiles!
--------------------
Add this to `deploy.rb`

    desc &quot;tail production log files&quot; 
    task :tail_logs, :roles =&gt; :app do
      run &quot;tail -f #{shared_path}/log/production.log&quot; do |channel, stream, data|
        puts  # for an extra line break before the host name
        puts &quot;#{channel[:host]}: #{data}&quot; 
        break if stream == :err    
      end
    end

Then run it with

    cap tail_logs
    
Capistrano isn't just for deploying Rails apps. You can use it to automate anything
you do with SSH. 
  





    </code></pre></noscript></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[初学capistrano]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/09/starting-capistrano/"/>
    <updated>2011-12-09T15:56:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/09/starting-capistrano</id>
    <content type="html"><![CDATA[<p>上一篇博客<a href="http://geekontheway.github.com/blog/2011/12/08/from-ssl-to-ssh/">从capistrano说起</a>谈到了capistrano,刚接触有很多地方不懂，就拿出这篇博客做一个记录,有什么新的发现和问题，都会放上来.</p>

<h2>capistrano-ex</h2>

<p>注意到安装<code>capistrano</code>的时候还要安装<code>capistrano-ex</code>这个gem包,官方的介绍是 <code>capistrano-ex allows you to setup multiple deploy environments</code>.</p>

<p>使用方法：</p>

<ul>
<li>定义stage:</li>
</ul>


<figure class='code'><figcaption><span>config/deploy.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">set</span> <span class="ss">:stages</span><span class="p">,</span> <span class="sx">%w(production development)</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:default_stage</span><span class="p">,</span> <span class="s2">&quot;development&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;capistrano/ext/multistage&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>设置stage</li>
</ul>


<p>在config目录下创建deploy目录，并在其中修改各stage的配置.</p>

<figure class='code'><figcaption><span>config/ </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">cat</span> <span class="n">production</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:rails_env</span><span class="p">,</span> <span class="s2">&quot;production&quot;</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:web</span><span class="p">,</span> <span class="s2">&quot;productionserver.com&quot;</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:app</span><span class="p">,</span> <span class="s2">&quot;productionserver.com&quot;</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:db</span><span class="p">,</span>  <span class="s2">&quot;productionserver.com&quot;</span><span class="p">,</span> <span class="ss">:primary</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'><span class="err">$</span> <span class="n">cat</span> <span class="n">development</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:rails_env</span><span class="p">,</span> <span class="s2">&quot;development&quot;</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:web</span><span class="p">,</span> <span class="s2">&quot;developmentserver.com&quot;</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:app</span><span class="p">,</span> <span class="s2">&quot;developmentserver.com&quot;</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:db</span><span class="p">,</span>  <span class="s2">&quot;developmentserver.com&quot;</span><span class="p">,</span> <span class="ss">:primary</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>运行特定stage的deploy</li>
</ul>


<p><code>cap stagename deploy</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[分享一个全局RVM的安装脚本 Ubuntu 10.04 ]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/09/rvm-system-wide-install-script/"/>
    <updated>2011-12-09T15:27:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/09/rvm-system-wide-install-script</id>
    <content type="html"><![CDATA[

<figure class='code'><figcaption><span>Includes: StackScript Bash Library </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c"># &lt;udf name=&quot;admin_login&quot; label=&quot;Admin Login&quot; /&gt;</span>
</span><span class='line'><span class="c"># &lt;udf name=&quot;admin_password&quot; label=&quot;Admin Password&quot; /&gt;</span>
</span><span class='line'><span class="c"># &lt;udf name=&quot;group_name&quot; label=&quot;RVM Group name&quot; default=&quot;rvm&quot; /&gt;</span>
</span><span class='line'><span class="nb">source</span> &lt;ssinclude <span class="nv">StackScriptID</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;
</span><span class='line'>system_update
</span><span class='line'>hostname <span class="sb">`</span>get_rdns_primary_ip<span class="sb">`</span>
</span><span class='line'>aptitude -y install sudo
</span><span class='line'>groupadd wheel
</span><span class='line'>cp /etc/sudoers /etc/sudoers.tmp
</span><span class='line'>chmod 0640 /etc/sudoers.tmp
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;%wheel ALL = (ALL) ALL&quot;</span> &gt;&gt; /etc/sudoers.tmp
</span><span class='line'>chmod 0440 /etc/sudoers.tmp
</span><span class='line'>mv /etc/sudoers.tmp /etc/sudoers
</span><span class='line'>useradd -m -s /bin/bash -G wheel <span class="s2">&quot;$ADMIN_LOGIN&quot;</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;${ADMIN_LOGIN}:${ADMIN_PASSWORD}&quot;</span> | chpasswd
</span><span class='line'><span class="nb">export </span><span class="nv">rvm_group_name</span><span class="o">=</span><span class="s2">&quot;$GROUP_NAME&quot;</span>
</span><span class='line'>aptitude -y install curl bison build-essential zlib1g-dev libssl-dev libreadline5-dev libxml2-dev git-core
</span><span class='line'>bash &lt; &lt;<span class="o">(</span> curl -L http://bit.ly/rvm-install-system-wide <span class="o">)</span>
</span><span class='line'>usermod -a -G <span class="s2">&quot;$GROUP_NAME&quot;</span> <span class="s2">&quot;$ADMIN_LOGIN&quot;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[从Capsitrano说起]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/08/from-ssl-to-ssh/"/>
    <updated>2011-12-08T19:20:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/08/from-ssl-to-ssh</id>
    <content type="html"><![CDATA[<h1>Capistrano with bundler</h1>

<p>起因是昨天要部署公司的一个测试项目bar到linode服务器,部署代码是之前写的,正好拿来学习了:</p>

<p><code>$ gem list capistrano</code></p>

<blockquote><p><strong><em> LOCAL GEMS </em></strong></p>

<p>capistrano (2.9.0)</p>

<p>capistrano-ext (1.2.1)</p></blockquote>

<figure class='code'><figcaption><span>title: deploy.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1"># -*- encoding : utf-8 -*-</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:stages</span><span class="p">,</span> <span class="sx">%w(production staging)</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:default_stage</span><span class="p">,</span> <span class="s2">&quot;production&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;capistrano/ext/multistage&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:application</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:use_sudo</span><span class="p">,</span> <span class="kp">false</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:scm</span><span class="p">,</span> <span class="ss">:git</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:deploy_via</span><span class="p">,</span> <span class="ss">:remote_cache</span>
</span><span class='line'>
</span><span class='line'><span class="n">default_run_options</span><span class="o">[</span><span class="ss">:pty</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'><span class="n">ssh_options</span><span class="o">[</span><span class="ss">:forward_agent</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:git_shallow_clone</span><span class="p">,</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:git_enable_submodules</span><span class="p">,</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>title: deploy/staging.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1"># -*- encoding : utf-8 -*-</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:user</span><span class="p">,</span> <span class="s2">&quot;root&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:repository</span><span class="p">,</span> <span class="s2">&quot;git@github.com:foo/bar.git&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:branch</span><span class="p">,</span> <span class="s2">&quot;master&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:deploy_to</span><span class="p">,</span> <span class="s2">&quot;/home/staging/www/bar&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">role</span> <span class="ss">:web</span><span class="p">,</span> <span class="s2">&quot;foo.bar.com&quot;</span> <span class="c1"># Your HTTP server, Apache/etc</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:app</span><span class="p">,</span> <span class="s2">&quot;foo.bar.com&quot;</span> <span class="c1"># This may be the same as your `Web` server</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:db</span><span class="p">,</span> <span class="s2">&quot;foo.bar.com&quot;</span><span class="p">,</span> <span class="ss">:primary</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="c1"># This is where Rails migrations will run</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># tasks</span>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:deploy</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:start</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;touch </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">/tmp/restart.txt&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:stop</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="c1"># Do nothing.</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Restart Application&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:restart</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;touch </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">/tmp/restart.txt&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Symlink shared resources on each release&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:symlink_shared</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;ln -nfs </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/config/database.yml </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/config/database.yml&quot;</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;ln -nfs </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/config/mailers.yml </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/config/mailers.yml&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#run &quot;mkdir #{release_path}/public/stylesheets/compiled&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;ln -nfs </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/ckeditor_assets </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/public/ckeditor_assets&quot;</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;ln -nfs </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/system </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/public/system&quot;</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;chmod 0777 </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/public/stylesheets/compiled&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">after</span> <span class="s1">&#39;deploy:update_code&#39;</span><span class="p">,</span> <span class="s1">&#39;deploy:symlink_shared&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:db</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;migrate db&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:migrate</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;cd </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2"> &amp;&amp; RAILS_ENV=production rake db:migrate&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行部署后报错：</p>

<p> <img src="http://p4.42qu.us/721/820/149300.jpg"></p>

<p> 查了下原因，官方这么描述：</p>

<blockquote><p>Before deploying an app that uses Bundler, Add your Gemfile and Gemfile.lock to source control, but ignore the .bundle folder, which is specific to each machine.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo ".bundle\n" >> .gitignore
</span><span class='line'>$ git add Gemfile Gemfile.lock .gitignore
</span><span class='line'>$ git commit -m "Add Bundler support"</span></code></pre></td></tr></table></div></figure>


<p>然后在deploy.rb中加入<code>require "bundler/capistrano"</code>
 <img src="http://p4.42qu.us/721/819/149299.jpg"></p>

<p>数据没部署上去,应该是链接没做好,部署脚本是之前同事写的,关于Symlink这部分,我又谷歌了一下:</p>

<p><code>Update @ 2011-12-9 11:17</code></p>

<ul>
<li><p>The <code>current</code>directory is where the most current version of your Rails application is located. Each time you deploy your application, the contents of this directory are overwritten with your new changes.</p></li>
<li><p>The <code>releases</code> directory stores previous releases of your application, which allow Capistrano to &#8220;roll back&#8221; changes in the event that something goes wrong. Each time you deploy your application, the contents of the current directory are moved to the releases before the new version is copied to the current directory. You will want to limit the number of previous releases that are stored to preserve disk space. This can be done by running cap deploy:cleanup.</p></li>
<li><p>The <code>shared</code> directory contains assets that are independent of the version of your application. In other words, the shared directory is left alone during a deployment, which makes it a perfect place to hold uploaded files and documents that you want to preserve between migrations.This is a great time to mention that that config/database.yml file is a wonderful candidate for storing in the shared directory and symlinking to it. By doing this, you can avoid having to publish your development and testing passwords, and multiple developers can easily collaborate on the same project.</p></li>
</ul>


<p>Rather than having to manually create our symlinks,  Luckily, we can create a Capistrano deployment recipe that automates this task.Since our application is already up and running, we will only be adding some things to the end of the recipe that is currently in place for your web host. In this example we create a namespace called &#8220;customs&#8221; for our new tasks:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>namespace(:customs) do
</span><span class='line'>  task :config, :roles => :app do
</span><span class='line'>    run &lt;&lt;-CMD
</span><span class='line'>      ln -nfs #{shared_path}/system/database.yml #{release_path}/config/database.yml
</span><span class='line'>    CMD
</span><span class='line'>  end
</span><span class='line'>  task :symlink, :roles => :app do
</span><span class='line'>    run &lt;&lt;-CMD
</span><span class='line'>      ln -nfs #{shared_path}/system/uploads #{release_path}/public/uploads
</span><span class='line'>    CMD
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>In order to get Capistrano to perform these tasks each time we deploy our application, we need to set some hooks by placing the following code at the bottom of our deploy.rb file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>after "deploy:update_code", "customs:config"
</span><span class='line'>after "deploy:symlink","customs:symlink"
</span><span class='line'>after "deploy", "deploy:cleanup"</span></code></pre></td></tr></table></div></figure>


<p>The first line tells Capistrano that after it has performed the update_code methods, which updates the Rails application, that it should symlink to our shared database.yml file so that Rails has the production database configuration settings.</p>

<p>The next line tells Capistrano that once it has finished symlinking the application (a normal deploy involves symlinking to the current directory), it should then create the symlink for our uploads directory.</p>

<p>Finally, I have added a third line that tells Capistrano to finish it all up by running the cap deploy:cleanup task, which removes all but the last 5 releases from the releases directory. We do this for good housekeeping reasons so that we are not bloating our server with releases that we don&#8217;t need.</p>

<h1>RVM Issue</h1>

<p>报错提示：
<img src="http://p4.42qu.us/721/821/149301.jpg"></p>

<p>好像是rvm不能选择ruby版本的问题。[后来发了一个帖子关于Linode上RVM的奇怪问题，每次ssh登陆服务器后，发现rvm并未选择ruby版本，即使上次登陆的时候rvm的默认ruby选项][http://ruby-china.org/topics/386],用了大家给的方法后,没找到合适答案后,rebuild linode服务器.</p>

<p><code>Update @ 2011-12-9 12:57</code></p>

<p>还是找到了Rvm的解决方案:</p>

<p>When you use capistrano it uses a non-interactive ssh session which doesn&#8217;t run .profile or .bash_rc and it gets you a really bare bones environment. You will have to specify all the variables you need to use. This is especially important with RVM which relies on a lot of variables to work properly.</p>

<p>The following can be added to your capistrano recipe:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set :default_environment, {
</span><span class='line'>'PATH' => "/usr/local/sphinx/bin:/usr/local/rvm/gems/ruby-1.9.2-p0/bin:/usr/local/rvm/gems/ruby-1.9.2-p0@global/bin:/usr/local/rvm/rubies/ruby-1.9.2-p0/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
</span><span class='line'>'RUBY_VERSION' => 'ruby-1.9.2-p0',
</span><span class='line'>'GEM_HOME' => '/usr/local/rvm/gems/ruby-1.9.2-p0',
</span><span class='line'>'GEM_PATH' => '/usr/local/rvm/gems/ruby-1.9.2-p0:/usr/local/rvm/gems/ruby-1.9.2-p0@global',
</span><span class='line'>'BUNDLE_PATH' => '/usr/local/rvm/gems/ruby-1.9.2-p0',
</span><span class='line'>'MY_RUBY_HOME' => '/usr/local/rvm/rubies/ruby-1.9.2-p0',
</span><span class='line'>:'RAILS_ENV' => 'production'
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>You&#8217;ll probably have to tweak this for your particular enviroment, but hopefully this gives you a good starting point to work from.</p>

<h1>Rebuild Linode</h1>

<ul>
<li>ssh到服务器，做最基本的配置：</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to Ubuntu!
</span><span class='line'> * Documentation:  https://help.ubuntu.com/
</span><span class='line'>Last login: Wed Dec  7 21:24:41 2011 from 182.18.65.14
</span><span class='line'>
</span><span class='line'>root@li389-178:~# echo "log.networking.io" > /etc/hostname
</span><span class='line'>root@li389-178:~# hostname -F /etc/hostname
</span><span class='line'>
</span><span class='line'>root@log:~# sudo dpkg-reconfigure tzdata
</span><span class='line'>
</span><span class='line'>Current default time zone: 'Asia/Chongqing'
</span><span class='line'>Local time is now:      Thu Dec  8 10:28:55 CST 2011.
</span><span class='line'>Universal Time is now:  Thu Dec  8 02:28:55 UTC 2011.</span></code></pre></td></tr></table></div></figure>


<h1>Chef-Cookbooks&amp;Recipe</h1>

<ul>
<li>因为又要装很多服务，而且也会有很多配置,考虑到效率，选择使用chef-repo,本地建立chef workstation。</li>
<li>表示一下,chef的文档太详细了!</li>
<li>前阵子修改了服务器域名转向,需要修改一下.SSH中的known_hosts,删掉冲突的行就行了.</li>
<li>chef-repo依然是git版本控制,很强大</li>
</ul>


<p>先看个在远程服务器node上安装apache2的sample:</p>

<figure class='code'><figcaption><span>local:workstation </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Zh:chef-repo bill$ knife cookbook site install apache2
</span><span class='line'>Zh:chef-repo bill$ knife node run_list node name add "recipe[apache2]"
</span><span class='line'>Zh:chef-repo bill$ ls cookbooks/
</span><span class='line'>apache2   
</span><span class='line'>Zh:chef-repo bill$ knife node run_list add "recipe[apache2]"
</span><span class='line'>Zh:chef-repo bill$ knife cookbook upload apache2
</span><span class='line'>Uploading apache2             [1.0.2]
</span><span class='line'>upload complete
</span><span class='line'>Zh:chef-repo bill$ knife node show log -r
</span><span class='line'>run_list:  recipe[apache2]</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>node:nodename </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nodename:# sudo chef client</span></code></pre></td></tr></table></div></figure>


<h2>安装workstation配置chef-client</h2>

<ul>
<li>因为使用的是Hosted-Chef,所以首先你要有一个opscode的账号,免费版的提供五个节点和两个管理员权限.然后创建一个orgnazition，会提示你下载knife配置文件和密钥文件,然后也到Users的界面生成密钥,一起下载下来</li>
<li>安装依赖:ruby ree +,ruby-dev,libopenssl-ruby,ri,irb,build-essential,wget,ssl-cert,git-core</li>
<li>安装rubygems:下载源码后解压，cd到该路径,执行<code>sudo ruby setup.rb --no-format-executable</code></li>
<li>安装chef，创建必须的目录</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Zh:~ bill$ sudo gem install chef
</span><span class='line'>Zh:~ bill$ git clone https://github.com/opscode/chef-repo.git
</span><span class='line'>  
</span><span class='line'>  # create chef configuration directories:
</span><span class='line'>Zh:~ bill$ mkdir -p ~/chef-repo/.chef
</span><span class='line'>  
</span><span class='line'>  # copy the keys and knife configuration you download into this directory
</span><span class='line'>Zh:~ bill$ cp USERNAME.pem ~/chef-repo/.chef
</span><span class='line'>Zh:~ bill$ cp ORGANIZATION-validator.pem ~/Documents/chef-repo/.chef
</span><span class='line'>Zh:~ bill$ cp knife.rb ~/chef-repo/.chef</span></code></pre></td></tr></table></div></figure>


<ul>
<li>测试一下knife是否与Hosted Chef API 建立了连接</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Zh:chef-repo bill$ knife client list
</span><span class='line'>  ORGNIZATION-validator</span></code></pre></td></tr></table></div></figure>


<blockquote><p>workstation就完成了,现在可以下载并上传recipe,以及用knife管理node的配置安装工作了.你可以选择将workstation这台电脑配置成chef-client,或者在一个node上配置chef-client并用workstation管理它.</p></blockquote>

<h3>配置本地的chef client</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Zh:~ bill$ cd chef-repo
</span><span class='line'>Zh:~ bill$ knife configure client ./client-config
</span><span class='line'>#After this done,you will have a client-config directory in your local repository:
</span><span class='line'>
</span><span class='line'>Zh:~ bill$ sudo mkdir /etc/clef
</span><span class='line'>Zh:~ bill$ sudo cp -r ~/chef-repo/client-config/* /etc/chef
</span><span class='line'>
</span><span class='line'>#You will now need to run chef-client for the first time,so your node is added to the client list.
</span><span class='line'>Zh:~ bill$ sudo chef-client
</span><span class='line'>
</span><span class='line'>#Check if works
</span><span class='line'>Zh:~ bill$ cd chef-repo
</span><span class='line'>Zh:chef-repo bill$ knife client list</span></code></pre></td></tr></table></div></figure>


<h4>cookbook</h4>

<h4>recipe</h4>

<h3>配置远程的chef client</h3>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[nginx自启动设置]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/06/nginx-autorun-with-init-scripts/"/>
    <updated>2011-12-06T19:40:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/06/nginx-autorun-with-init-scripts</id>
    <content type="html"><![CDATA[<p>大二使用ubuntu的时候，了解了一些开机自动运行服务的命令和配置，不过一直没机会也没环境去操作。所以这几天配置服务器时候就麻烦了一些。为什么会麻烦呢？因为不好的习惯，国人喜欢百度，喜欢不加思索复制粘贴，goole上又全是英文，不一定每个人都英语好。其实就是一个很小的问题，百度上是一大堆重复的讲的不清不楚的，没有平台观念，版本观念的[不过确实有例外，CSDN上很多文章还是不错的，程序员的个人博客里的文章也都有思考在里面]，其实说回来，linux自身的版本过多，发行版中的一些设置也一直在变，从技术上讲是好事，可是给普通用户带来了学习的压力。</p>

<blockquote><p>假定你：</p></blockquote>

<ul>
<li>熟悉linux的运行级别[runlevel]</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0    关闭（或终止）系统
</span><span class='line'> 1    单用户模式：通常又称为 s 或 S
</span><span class='line'> 6    重启系统
</span><span class='line'> 2    没有网络的多用户模式
</span><span class='line'> 3    有网络的多用户模式
</span><span class='line'> 5    有网络和 X Window System的多用户模式</span></code></pre></td></tr></table></div></figure>


<p> 分享一下ngnix配置自动启动脚本：</p>

<div><script src='https://gist.github.com/1436747.js?file='></script>
<noscript><pre><code>[root@xjeevps opt]# cat /etc/init.d/nginx
#!/bin/bash 
# nginx Startup script for the Nginx HTTP Server 
# it is v.0.0.2 version. 
# chkconfig: - 85 15 
# description: Nginx is a high-performance web and proxy server. 
#              It has a lot of features, but it's not for everyone. 
# processname: nginx 
# pidfile: /var/run/nginx.pid 
# config: /usr/local/nginx/conf/nginx.conf 
nginxd=/usr/local/nginx/sbin/nginx 
nginx_config=/usr/local/nginx/conf/nginx.conf 
nginx_pid=/var/run/nginx.pid 
RETVAL=0 
prog=&quot;nginx&quot; 
# Source function library. 
. /etc/rc.d/init.d/functions 
# Source networking configuration. 
. /etc/sysconfig/network 
# Check that networking is up. 
[ ${NETWORKING} = &quot;no&quot; ] &amp;&amp; exit 0 
[ -x $nginxd ] || exit 0 
# Start nginx daemons functions. 
start() { 
if [ -e $nginx_pid ];then 
   echo &quot;nginx already running....&quot; 
   exit 1 
fi 
   echo -n $&quot;Starting $prog: &quot; 
   daemon $nginxd -c ${nginx_config} 
   RETVAL=$? 
   echo 
   [ $RETVAL = 0 ] &amp;&amp; touch /var/lock/subsys/nginx 
   return $RETVAL 
} 
# Stop nginx daemons functions. 
stop() { 
        echo -n $&quot;Stopping $prog: &quot; 
        killproc $nginxd 
        RETVAL=$? 
        echo 
        [ $RETVAL = 0 ] &amp;&amp; rm -f /var/lock/subsys/nginx /var/run/nginx.pid 
} 
# reload nginx service functions. 
reload() { 
    echo -n $&quot;Reloading $prog: &quot; 
    #kill -HUP `cat ${nginx_pid}` 
    killproc $nginxd -HUP 
    RETVAL=$? 
    echo 
} 
# See how we were called. 
case &quot;$1&quot; in 
start) 
        start 
        ;; 
stop) 
        stop 
        ;; 
reload) 
        reload 
        ;; 
restart) 
        stop 
        start 
        ;; 
status) 
        status $prog 
        RETVAL=$? 
        ;; 
*) 
        echo $&quot;Usage: $prog {start|stop|restart|reload|status|help}&quot; 
        exit 1 
esac 
exit $RETVAL
</code></pre></noscript></div>


<blockquote><p>Ubuntu natty</p></blockquote>

<ul>
<li>在/etc/init.d中建立脚本nginx，添加脚本进去，chmod+x</li>
<li>/usr/sbin/update-rc.d -f nginx defaults</li>
</ul>


<blockquote><p>or</p></blockquote>

<ul>
<li>sysv-rc-conf 设定2345运行nginx</li>
</ul>


<p>要启动或者停止,重启</p>

<p><code>/etc/init.d/nginx start/stop/restart</code></p>

<blockquote><p>CentOS5</p></blockquote>

<ul>
<li>在/etc/init.d中建立脚本nginx，添加脚本进去，chmod+x</li>
<li>/usr/sbin/update-rc.d -f nginx defaults</li>
</ul>


<blockquote><p>or</p></blockquote>

<ul>
<li>/sbin/chkconfig nginx 2345 on</li>
</ul>


<p>要启动或者停止,重启</p>

<p><code>service nginx start/stop/restart</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress: Blockquote]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/03/octopress-blockquote/"/>
    <updated>2011-12-03T12:48:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/03/octopress-blockquote</id>
    <content type="html"><![CDATA[<p>The blockquote plugin takes and <strong>author, source, title and quote, and outputs</strong> semantic HTML.</p>

<blockquote><p>Note that they also must start and end with brace and persent.</p></blockquote>

<h1>Syntax</h1>

<blockquote><p>blockquote [author[, source]] [link] [source_link_title]</p>

<p>Quote string</p>

<p> endblockquote</p></blockquote>

<p>You’ll notice there are two entries for source; one after author, and one after link. If you are citing from a printed work or a speech or something you cannot link to, use the first method Author&#8217;s Name, Cited Work. If you’re going to link to the work, omit the first source method, and add a source title after the link Author&#8217;s Name http://source.com Article title.</p>

<h3>Examples</h3>

<blockquote><p>Over the past 24 hours I&#8217;ve been reflecting on my life & I&#8217;ve realized only one thing. I need a medieval battle axe.</p><footer><strong>@allanbranch</strong><cite><a href='https://twitter.com/allanbranch/status/90766146063712256'>twitter.com/allanbranch/status/&hellip;</a></cite></footer></blockquote>




<blockquote><p>Every interaction is both precious and an opportunity to delight.</p><footer><strong>Seth Godin</strong><cite><a href='http://sethgodin.typepad.com/seths_blog/2009/07/welcome-to-island-marketing.html'>Welcome to Island Marketing</a></cite></footer></blockquote>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress: Codeblock]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/03/octopress-codeblock/"/>
    <updated>2011-12-03T12:21:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/03/octopress-codeblock</id>
    <content type="html"><![CDATA[<p>With this plugin you can write blocks of code directly in your posts and optionally add titles and links.</p>

<h1>Syntax</h1>

<p>Start and end must be in <strong>one couple of brace percent</strong>,they will also works in HTML block.</p>

<pre>
 codeblock [title] [lang:language] [url] [link text] 

 code snippet

 endcodeblock 
</pre>


<h1>Example</h1>

<pre>
 codeblock
Awesome code snippet
 endcodeblock
</pre>


<p>You can also add syntax highlighting like this.</p>

<pre>
 codeblock lang:objc
[rectangle setX: 10 y: 10 width: 20 height: 20];
 endcodeblock
</pre>


<p>Including a file extension in the title enables highlighting</p>

<pre>
 codeblock Time to be Awesome - awesome.rb
puts "Awesome!" unless lame
 endcodeblock
</pre>


<p>Pygments supports many languages, but doesn’t recognize some file extensions. Add lang:your_language to force highlighting if the filename doesn’t work.</p>

<pre>
 codeblock Here's an example .rvmrc file. lang:ruby
rvm ruby-1.8.6 # ZOMG, seriously? We still use this version?
 endcodeblock
</pre>


<p>Add an optional URL to enable downloading or linking to source.</p>

<pre>
 codeblock Javascript Array Syntax lang:js http://j.mp/pPUUmW MDN Documentation
var arr1 = new Array(arrayLength);
var arr2 = new Array(element0, element1, ..., elementN);
 endcodeblock
</pre>


<p>The last argument link_text is optional. You may want to link to a source for download file, or documentation on some other site.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress: 新手教程]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/03/octopress-for-freshman/"/>
    <updated>2011-12-03T09:16:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/03/octopress-for-freshman</id>
    <content type="html"><![CDATA[<p>Octopress基于jekyll，刚开始使用起来也比较复杂：</p>

<blockquote><p>Octopress会有两个分支：source（编写博客）和master（生成好的博客），就像这样：</p></blockquote>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git remote -v
</span><span class='line'>
</span><span class='line'>octopress git://github.com/imathis/octopress.git <span class="o">(</span>fetch<span class="o">)</span>
</span><span class='line'>octopress git://github.com/imathis/octopress.git <span class="o">(</span>push<span class="o">)</span>
</span><span class='line'>origin    git@github.com:geekontheway/geekontheway.github.com.git <span class="o">(</span>fetch<span class="o">)</span>
</span><span class='line'>origin    git@github.com:geekontheway/geekontheway.github.com.git <span class="o">(</span>push<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>git branch -a
</span><span class='line'>
</span><span class='line'>* <span class="nb">source</span>
</span><span class='line'><span class="nb">  </span>remotes/octopress/HEAD -&gt; octopress/master
</span><span class='line'>  remotes/octopress/compass
</span><span class='line'>  remotes/octopress/configuration
</span><span class='line'>  remotes/octopress/edge
</span><span class='line'>  remotes/octopress/generate_environment
</span><span class='line'>  remotes/octopress/gh-pages
</span><span class='line'>  remotes/octopress/master
</span><span class='line'>  remotes/octopress/move_rakefile_configs
</span><span class='line'>  remotes/octopress/post_names
</span><span class='line'>  remotes/octopress/rake_minify_js
</span><span class='line'>  remotes/octopress/refactor_code_highlight
</span><span class='line'>  remotes/octopress/refactor_deployment
</span><span class='line'>  remotes/octopress/refactor_js
</span><span class='line'>  remotes/octopress/site
</span><span class='line'>  remotes/octopress/site-deploy-test
</span><span class='line'>  remotes/octopress/subdir
</span><span class='line'>  remotes/octopress/thor
</span></code></pre></td></tr></table></div></figure>


<p>其中只有origin仓库和source分支是必须的，其余分支或仓库建议删掉。</p>

<p>我们来看一下source分支都有什么：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CHANGELOG.markdown  
</span><span class='line'>config.ru   
</span><span class='line'> _deploy  部署文件夹，在.gitignore中被设置了
</span><span class='line'>.DS_Store 文件夹显示属性，在.gitignore中被设置了
</span><span class='line'>Gemfile.lock  
</span><span class='line'>.gitignore  
</span><span class='line'>plugins  
</span><span class='line'>.pygments-cache   
</span><span class='line'>.rbenv-version Ruby版本有特殊要求 这个文件在.gitignore中被设置了   
</span><span class='line'>.rvmrc   Ruby版本有特殊要求
</span><span class='line'>.sass-cache  
</span><span class='line'>source
</span><span class='line'>config.rb           
</span><span class='line'>_config.yml  
</span><span class='line'>Gemfile  
</span><span class='line'>.git          
</span><span class='line'>.idea   Rubymine设置文件，在.gitignore中被设置了    
</span><span class='line'>public  在.gitignore中被设置了  
</span><span class='line'>Rakefile         
</span><span class='line'>README.markdown  
</span><span class='line'>sass    
</span><span class='line'>.slugignore  
</span><span class='line'>.themes</span></code></pre></td></tr></table></div></figure>


<p>其中_deploy,source,public这三个文件夹很有趣：</p>

<p><img src="http://p4.42qu.us/721/689/144049.jpg"></p>

<ul>
<li><p>如果你是和别人合作博客，或者自己同时在好几个电脑上写博客，每次开始之前，<code>git pull origin source</code>获得最新的文件,<code>rake generate</code>生成新的页面</p></li>
<li><p>我们在source分支做了博客的发布，或者改变了博客的设置之后，<code>rake generate</code>生成网站</p></li>
<li><p><code>rake watch</code>+pow 或者<code>rake review</code>+http://localhost:4000就可以看到我们所做的变化</p></li>
<li><p>确认无误后，<code>rake deploy</code>文章就发布到了博客中</p></li>
<li><p>当然，不要忘了更新项目 <code>git push origin source</code></p></li>
</ul>


<blockquote><p>特别的，如果你克隆了博客，记得在<code>git checkout source</code>，然后<code>rake setup_github_pages</code>执行初始化，当然，在那之前也需要<code>bundle install</code>，然后rake generate就生成页面了.</p>

<p>如果是新建的Repo ，记得</p></blockquote>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mkdir yourrepo
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>yourrepo
</span><span class='line'><span class="nv">$ </span>git init
</span><span class='line'><span class="c"># 其实这这时如果你多新建一个index.html文件的话，github会为你生成一个jekyll博客。</span>
</span><span class='line'><span class="nv">$ </span>touch README
</span><span class='line'><span class="nv">$ </span>git add .
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s1">&#39;first commit&#39;</span>
</span><span class='line'><span class="nv">$ </span>git remote add origin git@github.com:username/yourname.github.com.git
</span><span class='line'><span class="nv">$ </span>git push origin master
</span></code></pre></td></tr></table></div></figure>


<p>对于新手有几个提醒:</p>

<ul>
<li>时常<code>git status</code>,<code>git log</code>避免误操作</li>
<li>不要在github上直接编辑文件</li>
<li>想清楚了再下手</li>
<li>github pages的 username 大小写敏感。如果用户名和username不一致的话,默认会生成这个Repo的project pages。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress: Image tag]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/03/octopress-image-tag/"/>
    <updated>2011-12-03T07:42:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/03/octopress-image-tag</id>
    <content type="html"><![CDATA[<p>If you like Markdown’s syntax for images, you’ll love the simplicity of the Octopress image tag.</p>

<p>Syntax</p>

<blockquote><p>img [class names] /path/to/image [width] [height] [title text [alt text]]</p></blockquote>

<p>Don&#8217;t forget brace and percent couple.</p>

<p>Examples</p>

<blockquote><p>img http://placekitten.com/890/280</p>

<p>img left http://placekitten.com/320/250 Place Kitten #2</p>

<p>img right http://placekitten.com/300/500 150 250 Place Kitten #3</p>

<p>img right http://placekitten.com/300/500 150 250 &#8216;Place Kitten #4&#8217; &#8216;An image of a very cute kitten&#8217;</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress: Configuration files]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/02/octopress-configuration-files/"/>
    <updated>2011-12-02T07:44:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/02/octopress-configuration-files</id>
    <content type="html"><![CDATA[<h1>_config.yml</h1>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="c1"># ----------------------- #</span>
</span><span class='line'><span class="c1">#      Main Configs       #</span>
</span><span class='line'><span class="c1"># ----------------------- #</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://geekontheway.github.com</span>
</span><span class='line'><span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Geekontheway</span>
</span><span class='line'><span class="l-Scalar-Plain">subtitle</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Stay hungry Stay foolish</span>
</span><span class='line'><span class="l-Scalar-Plain">author</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Bill Zh</span>
</span><span class='line'><span class="l-Scalar-Plain">simple_search</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://google.com/search</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default date format is &quot;ordinal&quot; (resulting in &quot;July 22nd 2007&quot;)</span>
</span><span class='line'><span class="c1"># You can customize the format as defined in</span>
</span><span class='line'><span class="c1"># http://www.ruby-doc.org/core-1.9.2/Time.html#method-i-strftime</span>
</span><span class='line'><span class="c1"># Additionally, %o will give you the ordinal representation of the day</span>
</span><span class='line'><span class="l-Scalar-Plain">date_format</span><span class="p-Indicator">:</span> <span class="s">&quot;ordinal&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># RSS / Email (optional) subscription links (change if using something like Feedburner)</span>
</span><span class='line'><span class="l-Scalar-Plain">subscribe_rss</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/atom.xml</span>
</span><span class='line'><span class="l-Scalar-Plain">subscribe_email</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="c1"># RSS feeds can list your email address if you like</span>
</span><span class='line'><span class="l-Scalar-Plain">email</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># ----------------------- #</span>
</span><span class='line'><span class="c1">#    Jekyll &amp; Plugins     #</span>
</span><span class='line'><span class="c1"># ----------------------- #</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># If publishing to a subdirectory as in http://site.com/project set &#39;root: /project&#39;</span>
</span><span class='line'><span class="l-Scalar-Plain">root</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/</span>
</span><span class='line'><span class="l-Scalar-Plain">permalink</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/blog/:year/:month/:day/:title/</span>
</span><span class='line'><span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">source</span>
</span><span class='line'><span class="l-Scalar-Plain">destination</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">public</span>
</span><span class='line'><span class="l-Scalar-Plain">plugins</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">plugins</span>
</span><span class='line'><span class="l-Scalar-Plain">code_dir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">downloads/code</span>
</span><span class='line'><span class="l-Scalar-Plain">category_dir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">blog/categories</span>
</span><span class='line'><span class="l-Scalar-Plain">markdown</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rdiscount</span>
</span><span class='line'><span class="l-Scalar-Plain">pygments</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span> <span class="c1"># default python pygments have been replaced by pygments.rb</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">paginate</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10</span>          <span class="c1"># Posts per page on the blog index</span>
</span><span class='line'><span class="l-Scalar-Plain">pagination_dir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">blog</span>  <span class="c1"># Directory base for pagination URLs eg. /blog/page/2/</span>
</span><span class='line'><span class="l-Scalar-Plain">recent_posts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5</span>       <span class="c1"># Posts in the sidebar Recent Posts section</span>
</span><span class='line'><span class="l-Scalar-Plain">excerpt_link</span><span class="p-Indicator">:</span> <span class="s">&quot;Read</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">&amp;rarr;&quot;</span>  <span class="c1"># &quot;Continue reading&quot; link text at the bottom of excerpted articles</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">titlecase</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>       <span class="c1"># Converts page and post titles to tilecase</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># list each of the sidebar modules you want to include, in the order you want them to appear.</span>
</span><span class='line'><span class="c1"># To add custom asides, create files in /source/_includes/custom/asides/ and add them to the list like &#39;custom/asides/custom_aside_name.html&#39;</span>
</span><span class='line'><span class="l-Scalar-Plain">default_asides</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">asides/recent_posts.html</span><span class="p-Indicator">,</span> <span class="nv">asides/github.html</span><span class="p-Indicator">,</span> <span class="nv">asides/twitter.html</span><span class="p-Indicator">,</span> <span class="nv">asides/delicious.html</span><span class="p-Indicator">,</span> <span class="nv">asides/pinboard.html</span><span class="p-Indicator">,</span> <span class="nv">asides/googleplus.html</span><span class="p-Indicator">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Each layout uses the default asides, but they can have their own asides instead. Simply uncomment the lines below</span>
</span><span class='line'><span class="c1"># and add an array with the asides you want to use.</span>
</span><span class='line'><span class="c1"># blog_index_asides:</span>
</span><span class='line'><span class="c1"># post_asides:</span>
</span><span class='line'><span class="c1"># page_asides:</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># ----------------------- #</span>
</span><span class='line'><span class="c1">#   3rd Party Settings    #</span>
</span><span class='line'><span class="c1"># ----------------------- #</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Github repositories</span>
</span><span class='line'><span class="l-Scalar-Plain">github_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">geekontheway</span>
</span><span class='line'><span class="l-Scalar-Plain">github_repo_count</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0</span>
</span><span class='line'><span class="l-Scalar-Plain">github_show_profile_link</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class='line'><span class="l-Scalar-Plain">github_skip_forks</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Twitter</span>
</span><span class='line'><span class="l-Scalar-Plain">twitter_user</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="l-Scalar-Plain">twitter_tweet_count</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">4</span>
</span><span class='line'><span class="l-Scalar-Plain">twitter_show_replies</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class='line'><span class="l-Scalar-Plain">twitter_follow_button</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class='line'><span class="l-Scalar-Plain">twitter_show_follower_count</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class='line'><span class="l-Scalar-Plain">twitter_tweet_button</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Google +1</span>
</span><span class='line'><span class="l-Scalar-Plain">google_plus_one</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class='line'><span class="l-Scalar-Plain">google_plus_one_size</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">medium</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Google Plus Profile</span>
</span><span class='line'><span class="c1"># Hidden: No visible button, just add author information to search results</span>
</span><span class='line'><span class="l-Scalar-Plain">googleplus_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">xiaoliang@networking.io</span>
</span><span class='line'><span class="l-Scalar-Plain">googleplus_hidden</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Pinboard</span>
</span><span class='line'><span class="l-Scalar-Plain">pinboard_user</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="l-Scalar-Plain">pinboard_count</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">3</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Delicious</span>
</span><span class='line'><span class="l-Scalar-Plain">delicious_user</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="l-Scalar-Plain">delicious_count</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">3</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Disqus Comments</span>
</span><span class='line'><span class="l-Scalar-Plain">disqus_short_name</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="l-Scalar-Plain">disqus_show_comment_count</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Google Analytics</span>
</span><span class='line'><span class="l-Scalar-Plain">google_analytics_tracking_id</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Facebook Like</span>
</span><span class='line'><span class="l-Scalar-Plain">facebook_like</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span></code></pre></td></tr></table></div></figure>


<h1>config.rb</h1>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;yaml&#39;</span>
</span><span class='line'><span class="no">YAML</span><span class="o">::</span><span class="no">ENGINE</span><span class="o">.</span><span class="n">yamler</span> <span class="o">=</span> <span class="s1">&#39;syck&#39;</span>
</span><span class='line'><span class="n">project_type</span> <span class="o">=</span> <span class="ss">:stand_alone</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Publishing paths</span>
</span><span class='line'><span class="n">http_path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
</span><span class='line'><span class="n">http_images_path</span> <span class="o">=</span> <span class="s2">&quot;/images&quot;</span>
</span><span class='line'><span class="n">http_fonts_path</span> <span class="o">=</span> <span class="s2">&quot;/fonts&quot;</span>
</span><span class='line'><span class="n">css_dir</span> <span class="o">=</span> <span class="s2">&quot;public/stylesheets&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Local development paths</span>
</span><span class='line'><span class="n">sass_dir</span> <span class="o">=</span> <span class="s2">&quot;sass&quot;</span>
</span><span class='line'><span class="n">images_dir</span> <span class="o">=</span> <span class="s2">&quot;source/images&quot;</span>
</span><span class='line'><span class="n">fonts_dir</span> <span class="o">=</span> <span class="s2">&quot;source/fonts&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">line_comments</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="n">output_style</span> <span class="o">=</span> <span class="ss">:compressed</span>
</span></code></pre></td></tr></table></div></figure>


<h1>config.ru</h1>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;bundler/setup&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra/base&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># The project root directory</span>
</span><span class='line'><span class="vg">$root</span> <span class="o">=</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">SinatraStaticServer</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span><span class="p">(</span><span class="sr">/.+/</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">send_sinatra_file</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span><span class="mi">404</span><span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">not_found</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">send_sinatra_file</span><span class="p">(</span><span class="s1">&#39;404.html&#39;</span><span class="p">)</span> <span class="p">{</span><span class="s2">&quot;Sorry, I cannot find </span><span class="si">#{</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">send_sinatra_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">missing_file_block</span><span class="p">)</span>
</span><span class='line'>    <span class="n">file_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">),</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span>  <span class="n">path</span><span class="p">)</span>
</span><span class='line'>    <span class="n">file_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span> <span class="k">unless</span> <span class="n">file_path</span> <span class="o">=~</span> <span class="sr">/\.[a-z]+$/i</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="p">?</span> <span class="n">send_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="p">:</span> <span class="n">missing_file_block</span><span class="o">.</span><span class="n">call</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress: The first day]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/01/octopress-the-first-day/"/>
    <updated>2011-12-01T07:44:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/01/octopress-the-first-day</id>
    <content type="html"><![CDATA[<h1>Octopress Setup</h1>

<blockquote><p>First, I want to stress that Octopress is a blogging framework for hackers. You should be comfortable running shell commands and familiar with the basics of Git. If that sounds daunting, Octopress probably isn’t for you.</p></blockquote>

<h4>Before You Begin</h4>

<blockquote><p>You’ll need to install Git and set up your Ruby environment. Octopress requires Ruby <strong>1.9.2</strong> wich you can easily install with RVM or rbenv.</p></blockquote>

<p>If <code>ruby --version</code> doesn’t say you’re using Ruby 1.9.2, you may want to revisit your RVM installation.</p>

<blockquote><p>$git clone git://github.com/imathis/octopress.git octopress</p>

<p>$cd octopress</p></blockquote>

<p>   If you use RVM, You&#8217;ll be asked if you trust the .rvmrc file (say yes).</p>

<h4>Next, install dependencies.</h4>

<blockquote><p>$ bundle install</p></blockquote>

<p>   Mostly,you will see</p>

<pre>Using rake (0.9.2) 
    Installing RedCloth (4.2.8) with native extensions 
    Installing posix-spawn (0.3.6) with native extensions 
    Installing albino (1.3.3) 
    Installing blankslate (2.1.2.4) 
    Installing chunky_png (1.2.1) 
    Installing fast-stemmer (1.0.0) with native extensions 
    Installing classifier (1.3.3) 
    Installing fssm (0.2.7) 
    Installing sass (3.1.5) 
    Installing compass (0.11.5) 
    Installing directory_watcher (1.4.0) 
    Installing ffi (1.0.9) with native extensions 
    Installing haml (3.1.2) 
    Installing kramdown (0.13.3) 
    Installing liquid (2.2.2) 
    Installing syntax (1.0.0) 
    Installing maruku (0.6.0) 
    Installing jekyll (0.11.0) 
    Installing rubypython (0.5.1) 
    Installing pygments.rb (0.1.3) 
    Installing rack (1.3.2) 
    Installing rb-fsevent (0.4.3.1) with native extensions 
    Installing rdiscount (1.6.8) with native extensions 
    Installing rubypants (0.2.0) 
    Installing tilt (1.3.2) 
    Installing sinatra (1.2.6) 
    Installing stringex (1.3.0) 
    Using bundler (1.0.21) 
    Your bundle is complete! Use `bundle show [gemname]` to see where a bundled gem is installed.</pre>


<p><strong>Notes</strong>:you may get error like:</p>

<pre>rake aborted!
    You have already activated rake 0.9.2.2, but your Gemfile requires rake 0.9.2. Using bundle exec may solve this.

    (See full trace by running task with --trace)</pre>


<pre><code>As it to me,i just solve it by add `alias rake="bundle exec rake` to my **.bashrc**.
</code></pre>

<h4>Install the default Octopress theme.</h4>

<blockquote><p>$rake install</p></blockquote>

<h1>Configuring Octopress</h1>

<pre><code>Here’s a list of files for configuring Octopress.

- _config.yml       # Main config (Jekyll's settings)
- Rakefile          # Configs for deployment
- config.rb         # Compass config
- config.ru         # Rack config

Configurations in the Rakefile are mostly related to deployment and you probably won’t have to touch them unless you’re using rsync.
</code></pre>

<h4>Blog Configuration</h4>

<pre><code>In the _config.yml there are three sections for configuring your Octopress Blog. Spoiler: You must change url, and you’ll probably change title, subtitle and author and enable some 3rd party services.

Main Configs

- url:                # For rewriting urls for RSS, etc
- title:              # Used in the header and title tags
- subtitle:           # A description used in the header
- author:             # Your name, for RSS, Copyright, Metadata
- simple_search:      # Search engine for simple site search
- subscribe_rss:      # Url for your blog's feed, defauts to /atom.xml
- subscribe_email:    # Url to subscribe by email (service required)
- email:              # Email address for the RSS feed if you want it.
</code></pre>

<h4>Jekyll &amp; Plugins</h4>

<pre><code>These configurations are used by Jekyll and Plugins. If you’re not familiar with Jekyll, you should probably have a look at the [configuration docs](https://github.com/mojombo/jekyll/wiki/Configuration) which lists more options that aren’t covered here.

- root:               # Mapping for relative urls (default: /)
- permalink:          # Permalink structure for blog posts
- source:             # Directory for site source files
- destination:        # Directory for generated site files
- plugins:            # Directory for Jekyll plugins
- code_dir:           # Directory for code snippets (for include_code plugin)
- category_dir:       # Directory for generated blog category pages 
- pygments:           # Toggle python pygments syntax highlighting
- paginate:           # Posts per page on the blog index
- pagination_dir:     # Directory base for pagination URLs eg. /blog/page/2/
- recent_posts:       # Number of recent posts to appear in the sidebar 
- default_asides:     # Configure what shows up in the sidebar and in what order
- blog_index_asides:  # Optional sidebar config for blog index page
- post_asides:        # Optional sidebar config for post layout
- page_asides:        # Optional sidebar config for page layout

If you want to change the way permalinks are written for your blog posts, see Jekyll’s permalink docs.

Note: Jekyll has a baseurl config which offers mock subdirectory publishing support by adding a redirect to Jekyll’s WEBrick server. Please don’t use this. If you want to publish your site to a subdirectory, (see Deploying Octopress to a Subdirectory).
</code></pre>

<h4>3rd Party Settings</h4>

<pre><code>These third party integrations are already set up for you. Simply fill in the configurations and they’ll be added to your site.

- Twitter Setup a sidebar twitter feed, follow button, and tweet button (for sharing posts and pages).
- Google Plus One Setup sharing for posts and pages on Google’s plus one network.
- Pinboard Share your recent Pinboard bookmarks in the sidebar.
- Delicious Share your recent Delicious bookmarks in the sidebar.
- Disqus Comments Add your disqus short name to enable disqus comments on your site.
- Google Analytics Add your tracking id to enable Google Analytics tracking for your site.

The Octopress layouts read these configurations and only include the javascript and html necessary for the enabled services.
</code></pre>

<h1>Blogging Basics</h1>

<pre><code>Octopress offers some rake tasks to create post and pages preloaded with metadata and according to Jekyll’s naming conventions.
</code></pre>

<h4>Blog Posts</h4>

<pre><code>Blog posts must be stored in the source/_posts directory and named according to Jekyll’s naming conventions: YYYY-MM-DD-post-title.markdown. The name of the file will be used as the **url slug**, and the date helps with file distinction and determines the sorting order for post loops.

Octopress provides a rake task to create new blog posts with the right naming conventions, with sensible yaml metadata.
</code></pre>

<blockquote><p>rake new_post[&#8220;title&#8221;]</p></blockquote>

<pre><code>new_post expects a naturally written title and strips out undesirable url characters when creating the filename. The default file extension for new posts is markdown but you can configure that in the Rakefile.

Example
</code></pre>

<blockquote><p>rake new_post[&#8220;Zombie Ninjas Attack: A survivor&#8217;s retrospective&#8221;]</p></blockquote>

<pre><code>The filename will determine your url. With the default permalink settings the url would be something like `http://site.com/blog/2011/07/03/zombie-ninjas-attack-a-survivors-retrospective/index.html`

Open a post in a text editor and you’ll see a block of ** yaml front matter** which tells Jekyll how to processes posts and pages.
</code></pre>

<pre>---
    layout: post
    title: "Zombie Ninjas Attack: A survivor's retrospective"
    date: 2011-07-03 5:59
    comments: true
    categories:
    ---</pre>


<pre><code>Here you can **turn comments off and or categories** to your post. If you are working on a multi-author blog, you can add **author: Your Name** to the metadata for proper attribution on a post. If you are working on a draft, you can add  **published: false** to prevent it from being posted when you generate your blog.

You can add a single category or multiple categories like this.
</code></pre>

<blockquote><p>categories: Sass</p></blockquote>

<pre><code>or
</code></pre>

<blockquote><p>categories: [CSS3, Sass, Media Queries]</p></blockquote>

<h4>New Pages</h4>

<pre><code>You can add pages anywhere in your blog **source directory** and they’ll be parsed by Jekyll. The URL will correspond directly to the filepath, so about.markdown will become site.com/about.html. If you prefer the URL site.com/about/ you’ll want to create the page as about/index.markdown. Octopress has a rake task for creating new pages easily.
</code></pre>

<blockquote><p>rake new_page[super-awesome]</p></blockquote>

<pre><code> creates /source/super-awesome/index.markdown
</code></pre>

<blockquote><p>rake new_page[super-awesome/page.html]</p></blockquote>

<pre><code>  creates /source/super-awesome/page.html

  Like with the new post task, the default file extension is markdown but you can configure that in the Rakefile. A freshly generated page might look like this.
</code></pre>

<pre>---
      layout: page
      title: "Super Awesome"
      date: 2011-07-03 5:59
      comments: true
      sharing: true
      footer: true
      ---</pre>


<pre><code>  The title is derived from the filename so you’ll likely want to change that. This is very similar to the post yaml except it doesn’t include categories, and you can toggle sharing and comments or remove the footer altogether. If you don’t want to show a date on your page, just remove it from the yaml.
</code></pre>

<h4>Generate &amp; Preview</h4>

<blockquote><p>rake generate   # Generates posts and pages into the public directory</p>

<p>rake watch      # Watches source/ and sass/ for changes and regenerates</p>

<p>rake preview    # Watches, and mounts a webserver at http://localhost:4000</p></blockquote>

<pre><code>  Using the rake preview server is nice, but If you’re a POW user, you can set up your Octopress site like this.
</code></pre>

<blockquote><p>cd ~/.pow</p>

<p>ln -s /path/to/octopress octopress</p></blockquote>

<pre><code>  Now that you’re setup with POW, you’ll just run rake watch and load up http://octopress.dev instead.
</code></pre>

<h1>Deploying to Github Pages</h1>

<h3>With Github User/Organization pages</h3>

<pre><code>  Use this if you want to host a blog from http://username.github.com (though you can also use custom domains).

  Create a new Github repository and name the repository with your user name or organization name username.github.com or organization.github.com.

  Github Pages for users and organizations uses the master branch like the public directory on a web server, serving up the files at your Pages url http://username.github.com. 

  As a result, you’ll want to **work on the source for your blog in the source branch and commit the generated content to the master branch.** Octopress has a configuration task that helps you set all this up.
</code></pre>

<blockquote><p>$ rake setup_github_pages</p></blockquote>

<pre>Enter the read/write url for your repository: git@github.com:geekontheway/geekontheway.github.com.git
      Added remote git@github.com:geekontheway/geekontheway.github.com.git as origin
      Set origin as default remoteMaster branch renamed to 'source' for committing your blog source files
      Initialized empty Git repository in /home/nasa/www/octopress/_deploy/.git/
      [master (root-commit) 75592aa] Octopress init
       1 files changed, 1 insertions(+), 0 deletions(-)
     create mode 100644 index.html
         ## Now you can deploy to http://geekontheway.github.com with `rake deploy` ##</pre>


<pre><code> This will:

 - Ask you for your Github Pages repository url.
 - Rename the remote pointing to imathis/octopress from ‘origin’ to ‘octopress’
 - Add your Github Pages repository as the default origin remote.
 - Switch the active branch from master to source.
 - Configure your blog’s url according to your repository.
 - Setup a master branch in the _deploy directory for deployment.

 Next run:
</code></pre>

<blockquote><p>rake generate</p>

<p>rake deploy</p></blockquote>

<pre><code> This will generate your blog, copy the generated files into _deploy/, add them to git, commit and push them up to the master branch. In a few seconds you should get an email from Github telling you that your commit has been received and will be published on your site.

 Don’t forget to commit the source for your blog.
</code></pre>

<blockquote><p>git add .</p>

<p>git commit -m &#8216;your message&#8217;</p>

<p>git push origin source</p></blockquote>

<pre><code> After all done ,your config may looks like:


 &lt;pre&gt;nasa@ubuntu:~/www/octopress$ git remote -v

 octopress  git://github.com/imathis/octopress.git (fetch)
 octopress  git://github.com/imathis/octopress.git (push)
 origin git@github.com:geekontheway/geekontheway.github.com.git (fetch)
 origin git@github.com:geekontheway/geekontheway.github.com.git (push)

nasa@ubuntu:~/www/octopress$ git branch -a

* source

    ...

    remotes/origin/source&lt;/pre&gt;
</code></pre>

<h4>Custom Domains</h4>

<p>First you’ll need to create a file named CNAME in the source containing your domain name.</p>

<blockquote><p>echo &#8216;your-domain.com&#8217; >> source/CNAME</p></blockquote>

<p>From Github’s Pages guide:</p>

<p>Next, you’ll need to visit your domain registrar or DNS host and add a record for your domain name. For a sub-domain like www.example.com you would simply create a CNAME record pointing at charlie.github.com. If you are using a top-level domain like example.com, you must use an A record pointing to 207.97.227.245.</p>

<p>Do not use a CNAME record with a top-level domain it can have adverse side effects on other services like email. Many DNS services will let you set a CNAME on a TLD, even though you shouldn’t. Remember that it may take up to a full day for DNS changes to propagate, so be patient.</p>
]]></content>
  </entry>
  
</feed>
