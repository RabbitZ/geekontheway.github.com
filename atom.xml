<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Geekontheway]]></title>
  <link href="http://geekontheway.github.com/atom.xml" rel="self"/>
  <link href="http://geekontheway.github.com/"/>
  <updated>2011-12-03T11:48:38+08:00</updated>
  <id>http://geekontheway.github.com/</id>
  <author>
    <name><![CDATA[Bill Zh]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Octopress: configuration files]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/02/octopress-configuration-files/"/>
    <updated>2011-12-02T07:44:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/02/octopress-configuration-files</id>
    <content type="html"><![CDATA[<h1>_config.yml</h1>

<pre>
# ----------------------- #
#      Main Configs       #
# ----------------------- #

url: http://geekontheway.github.com
title: Geekontheway 
subtitle: Stay hungry Stay foolish
author: Bill Zh
simple_search: http://google.com/search

# Default date format is "ordinal" (resulting in "July 22nd 2007")
# You can customize the format as defined in
# http://www.ruby-doc.org/core-1.9.2/Time.html#method-i-strftime
# Additionally, %o will give you the ordinal representation of the day
date_format: "ordinal"

# RSS / Email (optional) subscription links (change if using something like Feedburner)
subscribe_rss: /atom.xml
subscribe_email:
# RSS feeds can list your email address if you like
email:

# ----------------------- #
#    Jekyll & Plugins     #
# ----------------------- #

# If publishing to a subdirectory as in http://site.com/project set 'root: /project'
root: /
permalink: /blog/:year/:month/:day/:title/
source: source
destination: public
plugins: plugins
code_dir: downloads/code
category_dir: blog/categories
markdown: rdiscount
pygments: true # default python pygments have been replaced by pygments.rb

paginate: 10          # Posts per page on the blog index
pagination_dir: blog  # Directory base for pagination URLs eg. /blog/page/2/
recent_posts: 5       # Posts in the sidebar Recent Posts section
excerpt_link: "Read on &rarr;"  # "Continue reading" link text at the bottom of excerpted articles

titlecase: true       # Converts page and post titles to tilecase

# list each of the sidebar modules you want to include, in the order you want them to appear.
# To add custom asides, create files in /source/_includes/custom/asides/ and add them to the list like 'custom/asides/custom_aside_name.html'
default_asides: [asides/recent_posts.html, asides/github.html, asides/twitter.html, asides/delicious.html, asides/pinboard.html, asides/googleplus.html]

# Each layout uses the default asides, but they can have their own asides instead. Simply uncomment the lines below
# and add an array with the asides you want to use.
# blog_index_asides:
# post_asides:
# page_asides:

# ----------------------- #
#   3rd Party Settings    #
# ----------------------- #

# Github repositories
github_user: geekontheway
github_repo_count: 0
github_show_profile_link: true
github_skip_forks: true

# Twitter
twitter_user:
twitter_tweet_count: 4
twitter_show_replies: false
twitter_follow_button: true
twitter_show_follower_count: false
twitter_tweet_button: true

# Google +1
google_plus_one: true
google_plus_one_size: medium

# Google Plus Profile
# Hidden: No visible button, just add author information to search results
googleplus_user: xiaoliang@networking.io
googleplus_hidden: false

# Pinboard
pinboard_user:
pinboard_count: 3

# Delicious
delicious_user:
delicious_count: 3

# Disqus Comments
disqus_short_name:
disqus_show_comment_count: false

# Google Analytics
google_analytics_tracking_id:

# Facebook Like
facebook_like: false
</pre>


<h1>config.rb</h1>

<pre>
require 'yaml'
YAML::ENGINE.yamler = 'syck'
project_type = :stand_alone

# Publishing paths
http_path = "/"
http_images_path = "/images"
http_fonts_path = "/fonts"
css_dir = "public/stylesheets"

# Local development paths
sass_dir = "sass"
images_dir = "source/images"
fonts_dir = "source/fonts"

line_comments = false
output_style = :compressed
</pre>


<h1>config.ru</h1>

<pre>
require 'bundler/setup'
require 'sinatra/base'

# The project root directory
$root = ::File.dirname(__FILE__)

class SinatraStaticServer < Sinatra::Base  

  get(/.+/) do
      send_sinatra_file(request.path) {404}
    end

  not_found do
      send_sinatra_file('404.html') {"Sorry, I cannot find #{request.path}"}
    end

  def send_sinatra_file(path, &missing_file_block)
    file_path = File.join(File.dirname(__FILE__), 'public',  path)
    file_path = File.join(file_path, 'index.html') unless file_path =~ /\.[a-z]+$/i  
    File.exist?(file_path) ? send_file(file_path) : missing_file_block.call
  end

  end
 </pre>


<h1>Rakefile</h1>

<p>  <pre>
  require "rubygems"
  require "bundler/setup"
  require "stringex"</p>

<h2>-- Rsync Deploy config --</h2>

<h1>Be sure your public key is listed in your server's ~/.ssh/authorized_keys file</h1>

<p>  ssh_user       = "user@domain.com"
  ssh_port       = "22"
  document_root  = "~/website.com/"
  deploy_default = "push"</p>

<h1>This will be configured for you when you run config_deploy</h1>

<p>  deploy_branch  = "master"</p>

<h2>-- Misc Configs --</h2>

<p>  public_dir      = "public"    # compiled site directory
  source_dir      = "source"    # source file directory
  blog_index_dir  = 'source'    # directory for your blog's index page (if you put your index in source/blog/index.html, set this to 'source/blog')
  deploy_dir      = "<em>deploy"   # deploy directory (for Github pages deployment)
  stash_dir       = "</em>stash"    # directory to stash posts for speedy generation
  posts_dir       = "_posts"    # directory for blog files
  themes_dir      = ".themes"   # directory for blog files
  new_post_ext    = "markdown"  # default new post file extension when using the new_post task
  new_page_ext    = "markdown"  # default new page file extension when using the new_page task
  server_port     = "4000"      # port for preview server eg. localhost:4000</p>

<p>  desc "Initial setup for Octopress: copies the default theme into the path of Jekyll's generator. Rake install defaults to rake install[classic] to install a different theme run rake install[some_theme_name]"
  task :install, :theme do |t, args|</p>

<pre><code>if File.directory?(source_dir) || File.directory?("sass")
abort("rake aborted!") if ask("A theme is already installed, proceeding will overwrite existing files. Are you sure?", ['y', 'n']) == 'n'
</code></pre>

<p>  end</p>

<pre><code># copy theme into working Jekyll directories
theme = args.theme || 'classic'
</code></pre>

<p>  puts &#8220;## Copying &#8220;+theme+&#8221; theme into ./#{source_dir} and ./sass&#8221;</p>

<pre><code>mkdir_p source_dir
</code></pre>

<p>  cp_r &#8220;#{themes_dir}/#{theme}/source/.&#8221;, source_dir</p>

<pre><code>mkdir_p "sass"
</code></pre>

<p>  cp_r &#8220;#{themes_dir}/#{theme}/sass/.&#8221;, &#8220;sass&#8221;</p>

<pre><code>mkdir_p "#{source_dir}/#{posts_dir}"
</code></pre>

<p>  mkdir_p public_dir
  end</p>

<h6>#</h6>

<h1>Working with Jekyll</h1>

<h6>#</h6>

<p>  desc &#8220;Generate jekyll site&#8221;
  task :generate do</p>

<pre><code>raise "### You haven't set anything up yet. First run `rake install` to set up an Octopress theme." unless File.directory?(source_dir)
</code></pre>

<p>  puts &#8220;## Generating Site with Jekyll&#8221;</p>

<pre><code>system "compass compile --css-dir #{source_dir}/stylesheets"
</code></pre>

<p>  system &#8220;jekyll&#8221;
  end</p>

<p>  desc &#8220;Watch the site and regenerate when it changes&#8221;
  task :watch do</p>

<pre><code>raise "### You haven't set anything up yet. First run `rake install` to set up an Octopress theme." unless File.directory?(source_dir)
</code></pre>

<p>  puts &#8220;Starting to watch source with Jekyll and Compass.&#8221;</p>

<pre><code>system "compass compile --css-dir #{source_dir}/stylesheets" unless File.exist?("#{source_dir}/stylesheets/screen.css")
</code></pre>

<p>  jekyllPid = Process.spawn(&#8220;jekyll &#8211;auto&#8221;)</p>

<pre><code>compassPid = Process.spawn("compass watch")
</code></pre>

<p>  trap(&#8220;INT&#8221;) {</p>

<pre><code>  [jekyllPid, compassPid].each { |pid| Process.kill(9, pid) rescue Errno::ESRCH }
  exit 0
}
</code></pre>

<p>  [jekyllPid, compassPid].each { |pid| Process.wait(pid) }
  end</p>

<p>  desc &#8220;preview the site in a web browser&#8221;
  task :preview do</p>

<pre><code>raise "### You haven't set anything up yet. First run `rake install` to set up an Octopress theme." unless File.directory?(source_dir)
</code></pre>

<p>  puts &#8220;Starting to watch source with Jekyll and Compass. Starting Rack on port #{server_port}&#8221;</p>

<pre><code>system "compass compile --css-dir #{source_dir}/stylesheets" unless File.exist?("#{source_dir}/stylesheets/screen.css")
</code></pre>

<p>  jekyllPid = Process.spawn(&#8220;jekyll &#8211;auto&#8221;)</p>

<pre><code>compassPid = Process.spawn("compass watch")
</code></pre>

<p>  rackupPid = Process.spawn(&#8220;rackup &#8211;port #{server_port}&#8221;)</p>

<pre><code>trap("INT") {
[jekyllPid, compassPid, rackupPid].each { |pid| Process.kill(9, pid) rescue Errno::ESRCH }
exit 0
</code></pre>

<p>  }</p>

<p>  [jekyllPid, compassPid, rackupPid].each { |pid| Process.wait(pid) }
  end</p>

<h1>usage rake new_post[my-new-post] or rake new_post[&#8216;my new post&#8217;] or rake new_post (defaults to &#8220;new-post&#8221;)</h1>

<p>  desc &#8220;Begin a new post in #{source_dir}/#{posts_dir}&#8221;
  task :new_post, :title do |t, args|</p>

<pre><code>raise "### You haven't set anything up yet. First run `rake install` to set up an Octopress theme." unless File.directory?(source_dir)
</code></pre>

<p>  mkdir_p &#8220;#{source_dir}/#{posts_dir}&#8221;</p>

<pre><code>args.with_defaults(:title =&gt; 'new-post')
</code></pre>

<p>  title = args.title</p>

<pre><code>filename = "#{source_dir}/#{posts_dir}/#{Time.now.strftime('%Y-%m-%d')}-#{title.to_url}.#{new_post_ext}"
</code></pre>

<p>  if File.exist?(filename)</p>

<pre><code>abort("rake aborted!") if ask("#{filename} already exists. Do you want to overwrite?", ['y', 'n']) == 'n'
</code></pre>

<p>  end</p>

<pre><code>puts "Creating new post: #{filename}"
</code></pre>

<p>  open(filename, &#8216;w&#8217;) do |post|</p>

<pre><code>  post.puts "---"
  post.puts "layout: post"
  post.puts "title: \"#{title.gsub(/&amp;/,'&amp;amp;')}\""
  post.puts "date: #{Time.now.strftime('%Y-%m-%d %H:%M')}"
  post.puts "comments: true"
  post.puts "categories: "
  post.puts "---"
end
</code></pre>

<p>end</p>

<h1>usage rake new_page[my-new-page] or rake new_page[my-new-page.html] or rake new_page (defaults to &#8220;new-page.markdown&#8221;)</h1>

<p>desc &#8220;Create a new page in #{source_dir}/(filename)/index.#{new_page_ext}&#8221;
task :new_page, :filename do |t, args|
  raise &#8220;### You haven&#8217;t set anything up yet. First run <code>rake install</code> to set up an Octopress theme.&#8221; unless File.directory?(source_dir)</p>

<pre><code>args.with_defaults(:filename =&gt; 'new-page')
</code></pre>

<p>  page_dir = source_dir</p>

<pre><code>if args.filename =~ /(^.+\/)?([\w_-]+)(\.)?(.+)?/
page_dir += $4 ? "/#{$1}" : "/#{$1}#{$2}/"
name = $4 ? $2 : "index"
extension = $4 || "#{new_page_ext}"
filename = "#{name}.#{extension}"
mkdir_p page_dir
file = page_dir + filename
if File.exist?(file)
  abort("rake aborted!") if ask("#{file} already exists. Do you want to overwrite?", ['y', 'n']) == 'n'
  end
  puts "Creating new page: #{file}"
  open(file, 'w') do |page|
    page.puts "---"
  page.puts "layout: page"
    page.puts "title: \"#{$2.gsub(/[-_]/, ' ')}\""
  page.puts "date: #{Time.now.strftime('%Y-%m-%d %H:%M')}"
    page.puts "comments: true"
  page.puts "sharing: true"
    page.puts "footer: true"
  page.puts "---"
  end
else
puts "Syntax error: #{args.filename} contains unsupported characters"
</code></pre>

<p>  end
  end</p>

<h1>usage rake isolate[my-post]</h1>

<p>  desc &#8220;Move all other posts than the one currently being worked on to a temporary stash location (stash) so regenerating the site happens much quicker.&#8221;
  task :isolate, :filename do |t, args|</p>

<pre><code>stash_dir = "#{source_dir}/#{stash_dir}"
</code></pre>

<p>  FileUtils.mkdir(stash_dir) unless File.exist?(stash_dir)
  Dir.glob(&#8220;#{source_dir}/#{posts_dir}/<em>.</em>&#8221;) do |post|</p>

<pre><code>  FileUtils.mv post, stash_dir unless post.include?(args.filename)
</code></pre>

<p>  end
  end</p>

<p>  desc &#8220;Move all stashed posts back into the posts directory, ready for site generation.&#8221;
  task :integrate do</p>

<pre><code>FileUtils.mv Dir.glob("#{source_dir}/#{stash_dir}/*.*"), "#{source_dir}/#{posts_dir}/"
</code></pre>

<p>end</p>

<p>desc &#8220;Clean out caches: .pygments-cache, .gist-cache, .sass-cache&#8221;
task :clean do
  rm_rf [&#8220;.pygments-cache/<strong>&#8221;, &#8220;.gist-cache/</strong>&#8221;, &#8220;.sass-cache/**&#8221;, &#8220;source/stylesheets/screen.css&#8221;]
  end</p>

<p>  desc &#8220;Move sass to sass.old, install sass theme updates, replace sass/custom with sass.old/custom&#8221;
  task :update_style, :theme do |t, args|</p>

<pre><code>theme = args.theme || 'classic'
</code></pre>

<p>  if File.directory?(&#8220;sass.old&#8221;)</p>

<pre><code>  puts "removed existing sass.old directory"
  rm_r "sass.old", :secure=&gt;true
end
</code></pre>

<p>  mv &#8220;sass&#8221;, &#8220;sass.old&#8221;</p>

<pre><code>puts "## Moved styles into sass.old/"
</code></pre>

<p>  cp_r &#8220;#{themes_dir}/&#8221;+theme+&#8221;/sass/&#8221;, &#8220;sass&#8221;</p>

<pre><code>cp_r "sass.old/custom/.", "sass/custom"
</code></pre>

<p>  puts &#8220;## Updated Sass ##&#8221;
  end</p>

<p>  desc &#8220;Move source to source.old, install source theme updates, replace source/_includes/navigation.html with source.old&#8217;s navigation&#8221;
  task :update_source, :theme do |t, args|</p>

<pre><code>theme = args.theme || 'classic'
</code></pre>

<p>  if File.directory?(&#8220;#{source_dir}.old&#8221;)</p>

<pre><code>  puts "## Removed existing #{source_dir}.old directory"
  rm_r "#{source_dir}.old", :secure=&gt;true
end
</code></pre>

<p>  mkdir &#8220;#{source_dir}.old&#8221;</p>

<pre><code>cp_r "#{source_dir}/.", "#{source_dir}.old"
</code></pre>

<p>  puts &#8220;## Copied #{source_dir} into #{source_dir}.old/&#8221;</p>

<pre><code>cp_r "#{themes_dir}/"+theme+"/source/.", source_dir, :remove_destination=&gt;true
</code></pre>

<p>  cp_r &#8220;#{source_dir}.old/<em>includes/custom/.&#8221;, &#8220;#{source_dir}/</em>includes/custom/&#8221;, :remove_destination=>true</p>

<pre><code>cp "#{source_dir}.old/favicon.png", source_dir
</code></pre>

<p>  mv &#8220;#{source_dir}/index.html&#8221;, &#8220;#{blog_index_dir}&#8221;, :force=>true if blog_index_dir != source_dir</p>

<pre><code>cp "#{source_dir}.old/index.html", source_dir if blog_index_dir != source_dir &amp;&amp; File.exists?("#{source_dir}.old/index.html")
</code></pre>

<p>  puts &#8220;## Updated #{source_dir} ##&#8221;
  end</p>

<h6>#</h6>

<h1>Deploying</h1>

<h6>#</h6>

<p>  desc &#8220;Default deploy task&#8221;
  task :deploy do</p>

<pre><code>Rake::Task[:copydot].invoke(source_dir, public_dir)
</code></pre>

<p>  Rake::Task[&#8220;#{deploy_default}&#8221;].execute
  end</p>

<p>  desc &#8220;Generate website and deploy&#8221;
  task :gen_deploy => [:integrate, :generate, :deploy] do
  end</p>

<p>  desc &#8220;copy dot files for deployment&#8221;
  task :copydot, :source, :dest do |t, args|</p>

<pre><code>exclusions = [".", "..", ".DS_Store"]
</code></pre>

<p>  Dir[&#8220;#{args.source}/<em>*/.</em>&#8221;].each do |file|</p>

<pre><code>  if !File.directory?(file) &amp;&amp; !exclusions.include?(File.basename(file))
  cp(file, file.gsub(/#{args.source}/, "#{args.dest}"));
  end
end
</code></pre>

<p>end</p>

<p>desc &#8220;Deploy website via rsync&#8221;
task :rsync do
  puts &#8220;## Deploying website via Rsync&#8221;</p>

<pre><code>ok_failed system("rsync -avze 'ssh -p #{ssh_port}' --delete #{public_dir}/ #{ssh_user}:#{document_root}")
</code></pre>

<p>end</p>

<p>desc &#8220;deploy public directory to github pages&#8221;
multitask :push do
  puts &#8220;## Deploying branch to Github Pages &#8221;</p>

<pre><code>(Dir["#{deploy_dir}/*"]).each { |f| rm_rf(f) }
</code></pre>

<p>  Rake::Task[:copydot].invoke(public_dir, deploy_dir)
  puts &#8220;\n## copying #{public_dir} to #{deploy_dir}&#8221;</p>

<pre><code>cp_r "#{public_dir}/.", deploy_dir
</code></pre>

<p>  cd &#8220;#{deploy_dir}&#8221; do</p>

<pre><code>  system "git add ."
  system "git add -u"
  puts "\n## Commiting: Site updated at #{Time.now.utc}"
  message = "Site updated at #{Time.now.utc}"
  system "git commit -m \"#{message}\""
  puts "\n## Pushing generated #{deploy_dir} website"
  system "git push origin #{deploy_branch} --force"
  puts "\n## Github Pages deploy complete"
end
</code></pre>

<p>end</p>

<p>desc &#8220;Update configurations to support publishing to root or sub directory&#8221;
task :set_root_dir, :dir do |t, args|
  puts &#8220;>>> !! Please provide a directory, eg. rake config_dir[publishing/subdirectory]&#8221; unless args.dir</p>

<pre><code>if args.dir
if args.dir == "/"
  dir = ""
  else
    dir = "/" + args.dir.sub(/(\/*)(.+)/, "\\2").sub(/\/$/, '');
  end
  rakefile = IO.read(__FILE__)
  rakefile.sub!(/public_dir(\s*)=(\s*)(["'])[\w\-\/]*["']/, "public_dir\\1=\\2\\3public#{dir}\\3")
  File.open(__FILE__, 'w') do |f|
    f.write rakefile
end
compass_config = IO.read('config.rb')
compass_config.sub!(/http_path(\s*)=(\s*)(["'])[\w\-\/]*["']/, "http_path\\1=\\2\\3#{dir}/\\3")
compass_config.sub!(/http_images_path(\s*)=(\s*)(["'])[\w\-\/]*["']/, "http_images_path\\1=\\2\\3#{dir}/images\\3")
compass_config.sub!(/http_fonts_path(\s*)=(\s*)(["'])[\w\-\/]*["']/, "http_fonts_path\\1=\\2\\3#{dir}/fonts\\3")
compass_config.sub!(/css_dir(\s*)=(\s*)(["'])[\w\-\/]*["']/, "css_dir\\1=\\2\\3public#{dir}/stylesheets\\3")
File.open('config.rb', 'w') do |f|
  f.write compass_config
  end
  jekyll_config = IO.read('_config.yml')
  jekyll_config.sub!(/^destination:.+$/, "destination: public#{dir}")
  jekyll_config.sub!(/^subscribe_rss:\s*\/.+$/, "subscribe_rss: #{dir}/atom.xml")
  jekyll_config.sub!(/^root:.*$/, "root: /#{dir.sub(/^\//, '')}")
  File.open('_config.yml', 'w') do |f|
    f.write jekyll_config
end
rm_rf public_dir
mkdir_p "#{public_dir}#{dir}"
puts "## Site's root directory is now '/#{dir.sub(/^\//, '')}' ##"
</code></pre>

<p>  end
  end</p>

<p>  desc &#8220;Set up _deploy folder and deploy branch for Github Pages deployment&#8221;
task :setup_github_pages do
  repo_url = get_stdin(&#8220;Enter the read/write url for your repository: &#8220;)</p>

<pre><code>user = repo_url.match(/:([^\/]+)/)[1]
</code></pre>

<p>  branch = (repo_url.match(/\/[\w-]+.github.com/).nil?) ? &#8216;gh-pages&#8217; : &#8216;master&#8217;</p>

<pre><code>project = (branch == 'gh-pages') ? repo_url.match(/\/([^\.]+)/)[1] : ''
</code></pre>

<p>  unless <code>git remote -v</code>.match(/origin.+?octopress.git/).nil?</p>

<pre><code>  # If octopress is still the origin remote (from cloning) rename it to octopress
  system "git remote rename origin octopress"
  if branch == 'master'
    # If this is a user/organization pages repository, add the correct origin remote
  # and checkout the source branch for committing changes to the blog source.
    system "git remote add origin #{repo_url}"
  puts "Added remote #{repo_url} as origin"
    system "git config branch.master.remote origin"
  puts "Set origin as default remote"
    system "git branch -m master source"
  puts "Master branch renamed to 'source' for committing your blog source files"
  else
    unless !public_dir.match("#{project}").nil?
    system "rake set_root_dir[#{project}]"
  end
  end
end
</code></pre>

<p>  url = &#8220;http://#{user}.github.com&#8221;</p>

<pre><code>url += "/#{project}" unless project == ''
</code></pre>

<p>  jekyll_config = IO.read(&#8216;_config.yml&#8217;)</p>

<pre><code>jekyll_config.sub!(/^url:.*$/, "url: #{url}")
</code></pre>

<p>  File.open(&#8216;_config.yml&#8217;, &#8216;w&#8217;) do |f|</p>

<pre><code>  f.write jekyll_config
end
</code></pre>

<p>  rm_rf deploy_dir</p>

<pre><code>mkdir deploy_dir
</code></pre>

<p>  cd &#8220;#{deploy_dir}&#8221; do</p>

<pre><code>  system "git init"
  system "echo 'My Octopress Page is coming soon &amp;hellip;' &gt; index.html"
  system "git add ."
  system "git commit -m \"Octopress init\""
  system "git branch -m gh-pages" unless branch == 'master'
  system "git remote add origin #{repo_url}"
  rakefile = IO.read(__FILE__)
  rakefile.sub!(/deploy_branch(\s*)=(\s*)(["'])[\w-]*["']/, "deploy_branch\\1=\\2\\3#{branch}\\3")
  rakefile.sub!(/deploy_default(\s*)=(\s*)(["'])[\w-]*["']/, "deploy_default\\1=\\2\\3push\\3")
File.open(__FILE__, 'w') do |f|
  f.write rakefile
  end
end
</code></pre>

<p>  puts &#8220;\n&#8212;\n## Now you can deploy to #{url} with <code>rake deploy</code> ##&#8221;
  end</p>

<p>  def ok_failed(condition)
  if (condition)</p>

<pre><code>puts "OK"
</code></pre>

<p>  else</p>

<pre><code>  puts "FAILED"
end
</code></pre>

<p>end</p>

<p>def get_stdin(message)
  print message</p>

<pre><code>STDIN.gets.chomp
</code></pre>

<p>end</p>

<p>def ask(message, valid_options)
  if valid_options</p>

<pre><code>  answer = get_stdin("#{message} #{valid_options.to_s.gsub(/"/, '').gsub(/, /,'/')} ") while !valid_options.include?(answer)
else
answer = get_stdin(message)
</code></pre>

<p>  end</p>

<pre><code>answer
</code></pre>

<p>end</p>

<p>desc &#8220;list tasks&#8221;
task :list do
  puts &#8220;Tasks: #{(Rake::Task.tasks - [Rake::Task[:list]]).join(&#8216;, &#8216;)}&#8221;</p>

<pre><code>puts "(type rake -T for more detail)\n\n"
</code></pre>

<p>end
</pre></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress: The first day]]></title>
    <link href="http://geekontheway.github.com/blog/2011/12/01/octopress-the-first-day/"/>
    <updated>2011-12-01T07:44:00+08:00</updated>
    <id>http://geekontheway.github.com/blog/2011/12/01/octopress-the-first-day</id>
    <content type="html"><![CDATA[<h1>Octopress Setup</h1>

<blockquote><p>First, I want to stress that Octopress is a blogging framework for hackers. You should be comfortable running shell commands and familiar with the basics of Git. If that sounds daunting, Octopress probably isn’t for you.</p></blockquote>

<h4>Before You Begin</h4>

<blockquote><p>You’ll need to install Git and set up your Ruby environment. Octopress requires Ruby <strong>1.9.2</strong> wich you can easily install with RVM or rbenv.</p></blockquote>

<p>If <code>ruby --version</code> doesn’t say you’re using Ruby 1.9.2, you may want to revisit your RVM installation.</p>

<blockquote><p>$git clone git://github.com/imathis/octopress.git octopress</p>

<p>$cd octopress</p></blockquote>

<p>   If you use RVM, You&#8217;ll be asked if you trust the .rvmrc file (say yes).</p>

<h4>Next, install dependencies.</h4>

<blockquote><p>$ bundle install</p></blockquote>

<p>   Mostly,you will see</p>

<pre>Using rake (0.9.2) 
    Installing RedCloth (4.2.8) with native extensions 
    Installing posix-spawn (0.3.6) with native extensions 
    Installing albino (1.3.3) 
    Installing blankslate (2.1.2.4) 
    Installing chunky_png (1.2.1) 
    Installing fast-stemmer (1.0.0) with native extensions 
    Installing classifier (1.3.3) 
    Installing fssm (0.2.7) 
    Installing sass (3.1.5) 
    Installing compass (0.11.5) 
    Installing directory_watcher (1.4.0) 
    Installing ffi (1.0.9) with native extensions 
    Installing haml (3.1.2) 
    Installing kramdown (0.13.3) 
    Installing liquid (2.2.2) 
    Installing syntax (1.0.0) 
    Installing maruku (0.6.0) 
    Installing jekyll (0.11.0) 
    Installing rubypython (0.5.1) 
    Installing pygments.rb (0.1.3) 
    Installing rack (1.3.2) 
    Installing rb-fsevent (0.4.3.1) with native extensions 
    Installing rdiscount (1.6.8) with native extensions 
    Installing rubypants (0.2.0) 
    Installing tilt (1.3.2) 
    Installing sinatra (1.2.6) 
    Installing stringex (1.3.0) 
    Using bundler (1.0.21) 
    Your bundle is complete! Use `bundle show [gemname]` to see where a bundled gem is installed.</pre>


<p><strong>Notes</strong>:you may get error like:</p>

<pre>rake aborted!
    You have already activated rake 0.9.2.2, but your Gemfile requires rake 0.9.2. Using bundle exec may solve this.

    (See full trace by running task with --trace)</pre>


<pre><code>As it to me,i just solve it by add `alias rake="bundle exec rake` to my **.bashrc**.
</code></pre>

<h4>Install the default Octopress theme.</h4>

<blockquote><p>$rake install</p></blockquote>

<h1>Configuring Octopress</h1>

<pre><code>Here’s a list of files for configuring Octopress.

- _config.yml       # Main config (Jekyll's settings)
- Rakefile          # Configs for deployment
- config.rb         # Compass config
- config.ru         # Rack config

Configurations in the Rakefile are mostly related to deployment and you probably won’t have to touch them unless you’re using rsync.
</code></pre>

<h4>Blog Configuration</h4>

<pre><code>In the _config.yml there are three sections for configuring your Octopress Blog. Spoiler: You must change url, and you’ll probably change title, subtitle and author and enable some 3rd party services.

Main Configs

- url:                # For rewriting urls for RSS, etc
- title:              # Used in the header and title tags
- subtitle:           # A description used in the header
- author:             # Your name, for RSS, Copyright, Metadata
- simple_search:      # Search engine for simple site search
- subscribe_rss:      # Url for your blog's feed, defauts to /atom.xml
- subscribe_email:    # Url to subscribe by email (service required)
- email:              # Email address for the RSS feed if you want it.
</code></pre>

<h4>Jekyll &amp; Plugins</h4>

<pre><code>These configurations are used by Jekyll and Plugins. If you’re not familiar with Jekyll, you should probably have a look at the [configuration docs](https://github.com/mojombo/jekyll/wiki/Configuration) which lists more options that aren’t covered here.

- root:               # Mapping for relative urls (default: /)
- permalink:          # Permalink structure for blog posts
- source:             # Directory for site source files
- destination:        # Directory for generated site files
- plugins:            # Directory for Jekyll plugins
- code_dir:           # Directory for code snippets (for include_code plugin)
- category_dir:       # Directory for generated blog category pages 
- pygments:           # Toggle python pygments syntax highlighting
- paginate:           # Posts per page on the blog index
- pagination_dir:     # Directory base for pagination URLs eg. /blog/page/2/
- recent_posts:       # Number of recent posts to appear in the sidebar 
- default_asides:     # Configure what shows up in the sidebar and in what order
- blog_index_asides:  # Optional sidebar config for blog index page
- post_asides:        # Optional sidebar config for post layout
- page_asides:        # Optional sidebar config for page layout

If you want to change the way permalinks are written for your blog posts, see Jekyll’s permalink docs.

Note: Jekyll has a baseurl config which offers mock subdirectory publishing support by adding a redirect to Jekyll’s WEBrick server. Please don’t use this. If you want to publish your site to a subdirectory, (see Deploying Octopress to a Subdirectory).
</code></pre>

<h4>3rd Party Settings</h4>

<pre><code>These third party integrations are already set up for you. Simply fill in the configurations and they’ll be added to your site.

- Twitter Setup a sidebar twitter feed, follow button, and tweet button (for sharing posts and pages).
- Google Plus One Setup sharing for posts and pages on Google’s plus one network.
- Pinboard Share your recent Pinboard bookmarks in the sidebar.
- Delicious Share your recent Delicious bookmarks in the sidebar.
- Disqus Comments Add your disqus short name to enable disqus comments on your site.
- Google Analytics Add your tracking id to enable Google Analytics tracking for your site.

The Octopress layouts read these configurations and only include the javascript and html necessary for the enabled services.
</code></pre>

<h1>Blogging Basics</h1>

<pre><code>Octopress offers some rake tasks to create post and pages preloaded with metadata and according to Jekyll’s naming conventions.
</code></pre>

<h4>Blog Posts</h4>

<pre><code>Blog posts must be stored in the source/_posts directory and named according to Jekyll’s naming conventions: YYYY-MM-DD-post-title.markdown. The name of the file will be used as the **url slug**, and the date helps with file distinction and determines the sorting order for post loops.

Octopress provides a rake task to create new blog posts with the right naming conventions, with sensible yaml metadata.
</code></pre>

<blockquote><p>rake new_post[&#8220;title&#8221;]</p></blockquote>

<pre><code>new_post expects a naturally written title and strips out undesirable url characters when creating the filename. The default file extension for new posts is markdown but you can configure that in the Rakefile.

Example
</code></pre>

<blockquote><p>rake new_post[&#8220;Zombie Ninjas Attack: A survivor&#8217;s retrospective&#8221;]</p></blockquote>

<pre><code>The filename will determine your url. With the default permalink settings the url would be something like `http://site.com/blog/2011/07/03/zombie-ninjas-attack-a-survivors-retrospective/index.html`

Open a post in a text editor and you’ll see a block of ** yaml front matter** which tells Jekyll how to processes posts and pages.
</code></pre>

<pre>---
    layout: post
    title: "Zombie Ninjas Attack: A survivor's retrospective"
    date: 2011-07-03 5:59
    comments: true
    categories:
    ---</pre>


<pre><code>Here you can **turn comments off and or categories** to your post. If you are working on a multi-author blog, you can add **author: Your Name** to the metadata for proper attribution on a post. If you are working on a draft, you can add  **published: false** to prevent it from being posted when you generate your blog.

You can add a single category or multiple categories like this.
</code></pre>

<blockquote><p>categories: Sass</p></blockquote>

<pre><code>or
</code></pre>

<blockquote><p>categories: [CSS3, Sass, Media Queries]</p></blockquote>

<h4>New Pages</h4>

<pre><code>You can add pages anywhere in your blog **source directory** and they’ll be parsed by Jekyll. The URL will correspond directly to the filepath, so about.markdown will become site.com/about.html. If you prefer the URL site.com/about/ you’ll want to create the page as about/index.markdown. Octopress has a rake task for creating new pages easily.
</code></pre>

<blockquote><p>rake new_page[super-awesome]</p></blockquote>

<pre><code> creates /source/super-awesome/index.markdown
</code></pre>

<blockquote><p>rake new_page[super-awesome/page.html]</p></blockquote>

<pre><code>  creates /source/super-awesome/page.html

  Like with the new post task, the default file extension is markdown but you can configure that in the Rakefile. A freshly generated page might look like this.
</code></pre>

<pre>---
      layout: page
      title: "Super Awesome"
      date: 2011-07-03 5:59
      comments: true
      sharing: true
      footer: true
      ---</pre>


<pre><code>  The title is derived from the filename so you’ll likely want to change that. This is very similar to the post yaml except it doesn’t include categories, and you can toggle sharing and comments or remove the footer altogether. If you don’t want to show a date on your page, just remove it from the yaml.
</code></pre>

<h4>Generate &amp; Preview</h4>

<blockquote><p>rake generate   # Generates posts and pages into the public directory</p>

<p>rake watch      # Watches source/ and sass/ for changes and regenerates</p>

<p>rake preview    # Watches, and mounts a webserver at http://localhost:4000</p></blockquote>

<pre><code>  Using the rake preview server is nice, but If you’re a POW user, you can set up your Octopress site like this.
</code></pre>

<blockquote><p>cd ~/.pow</p>

<p>ln -s /path/to/octopress octopress</p></blockquote>

<pre><code>  Now that you’re setup with POW, you’ll just run rake watch and load up http://octopress.dev instead.
</code></pre>

<h1>Deploying to Github Pages</h1>

<h3>With Github User/Organization pages</h3>

<pre><code>  Use this if you want to host a blog from http://username.github.com (though you can also use custom domains).

  Create a new Github repository and name the repository with your user name or organization name username.github.com or organization.github.com.

  Github Pages for users and organizations uses the master branch like the public directory on a web server, serving up the files at your Pages url http://username.github.com. 

  As a result, you’ll want to **work on the source for your blog in the source branch and commit the generated content to the master branch.** Octopress has a configuration task that helps you set all this up.
</code></pre>

<blockquote><p>$ rake setup_github_pages</p></blockquote>

<pre>Enter the read/write url for your repository: git@github.com:geekontheway/geekontheway.github.com.git
      Added remote git@github.com:geekontheway/geekontheway.github.com.git as origin
      Set origin as default remoteMaster branch renamed to 'source' for committing your blog source files
      Initialized empty Git repository in /home/nasa/www/octopress/_deploy/.git/
      [master (root-commit) 75592aa] Octopress init
       1 files changed, 1 insertions(+), 0 deletions(-)
     create mode 100644 index.html
         ## Now you can deploy to http://geekontheway.github.com with `rake deploy` ##</pre>


<pre><code> This will:

 - Ask you for your Github Pages repository url.
 - Rename the remote pointing to imathis/octopress from ‘origin’ to ‘octopress’
 - Add your Github Pages repository as the default origin remote.
 - Switch the active branch from master to source.
 - Configure your blog’s url according to your repository.
 - Setup a master branch in the _deploy directory for deployment.

 Next run:
</code></pre>

<blockquote><p>rake generate</p>

<p>rake deploy</p></blockquote>

<pre><code> This will generate your blog, copy the generated files into _deploy/, add them to git, commit and push them up to the master branch. In a few seconds you should get an email from Github telling you that your commit has been received and will be published on your site.

 Don’t forget to commit the source for your blog.
</code></pre>

<blockquote><p>git add .</p>

<p>git commit -m &#8216;your message&#8217;</p>

<p>git push origin source</p></blockquote>

<pre><code> After all done ,your config may looks like:


 &lt;pre&gt;nasa@ubuntu:~/www/octopress$ git remote -v

 octopress  git://github.com/imathis/octopress.git (fetch)
 octopress  git://github.com/imathis/octopress.git (push)
 origin git@github.com:geekontheway/geekontheway.github.com.git (fetch)
 origin git@github.com:geekontheway/geekontheway.github.com.git (push)

nasa@ubuntu:~/www/octopress$ git branch -a

* source

    ...

    remotes/origin/source&lt;/pre&gt;
</code></pre>

<h4>Custom Domains</h4>

<p>First you’ll need to create a file named CNAME in the source containing your domain name.</p>

<blockquote><p>echo &#8216;your-domain.com&#8217; >> source/CNAME</p></blockquote>

<p>From Github’s Pages guide:</p>

<p>Next, you’ll need to visit your domain registrar or DNS host and add a record for your domain name. For a sub-domain like www.example.com you would simply create a CNAME record pointing at charlie.github.com. If you are using a top-level domain like example.com, you must use an A record pointing to 207.97.227.245.</p>

<p>Do not use a CNAME record with a top-level domain it can have adverse side effects on other services like email. Many DNS services will let you set a CNAME on a TLD, even though you shouldn’t. Remember that it may take up to a full day for DNS changes to propagate, so be patient.</p>
]]></content>
  </entry>
  
</feed>
